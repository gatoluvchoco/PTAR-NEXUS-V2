<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>PTAR Nexus V1 | Library Smart Digital Process</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
            colors: {
              nexus: {
                dark: '#0f172a',
                purple: '#6d28d9',
                glass: 'rgba(255, 255, 255, 0.1)',
                glassBorder: 'rgba(255, 255, 255, 0.2)',
              }
            },
            animation: {
              'scan': 'scan 2s linear infinite',
              'fade-in': 'fadeIn 0.3s ease-out',
            },
            keyframes: {
              scan: {
                '0%': { top: '0%' },
                '100%': { top: '100%' },
              },
              fadeIn: {
                '0%': { opacity: '0', transform: 'translateY(-10px)' },
                '100%': { opacity: '1', transform: 'translateY(0)' },
              }
            }
          }
        }
      }
    </script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background-color: #0f172a;
      }
      /* Custom Scrollbar hide */
      .scrollbar-hide::-webkit-scrollbar {
          display: none;
      }
      .scrollbar-hide {
          -ms-overflow-style: none;
          scrollbar-width: none;
      }
      /* Height fix for mobile browsers */
      .h-dvh {
        height: 100vh;
        height: 100dvh;
      }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Mock Data & Constants ---
        
        // Student Database
        const studentDatabase = {
          "2024441674": "AFFIE HAFIZAN KHAN BIN ALIJAN KHAN",
          "2024442374": "AMIRA SYAHAIREEN BINTI SAHDAN",
          "2024267258": "ANDRYSHA NYCHELLE ANAK ANDREW",
          "2024427454": "ARSYAD ZULHUSMI BIN KADAI",
          "2024298694": "BIJANI ANAK BAKAR",
          "2024436676": "CASYLVIA ANN ANAK ARMSTRONG",
          "2024436998": "DEAN DE DVINE JITEK",
          "2024206888": "DELLIA SUNGGAU ANAK DONNY",
          "2024670846": "EDIANA ANAK KAMIL",
          "2024223492": "ESTER AWANG",
          "2024288588": "FERGUSON QIUN ANAK LUTA",
          "2024212352": "HANIS YASMIN BINTI HARDYNORHAN",
          "2024419286": "HASNA NAZIRA BINTI AHMAD ROSALLAN",
          "2024204868": "HAZEL ANAK RITCHIE",
          "2024229294": "JAYCARLSON WILSON",
          "2024206946": "LUQMAN NURHAKIM OMARSHARIFF",
          "2024419516": "MOHAMAD ZAINORAZIEM BIN ZAINAL",
          "2024436008": "MOHammad SYAHRIL AZLIE",
          "2024681454": "MOHD AMIRUL HAFIZ BIN ILAH",
          "2024282012": "MUHAMAD HAZIM AKMAL BIN JAMAN",
          "2024411696": "MUHAMMAD AFIQ HAIQAL BIN MOHD ROSDI",
          "2024645246": "NA'IM ANIQ BIN BASRI",
          "2024299084": "NUR AYUNI BINTI SEPAWI",
          "2024244202": "NUR QAMARINA BINTI UZILA",
          "2024200648": "NUR SYAZA ADRIANA BINTI HASMAN",
          "2024427272": "NURFARAH AININ SOFIYA BINTI MAJELAN",
          "2024207026": "NURUL FARAHANA BINTI ABDULLAH",
          "2024223252": "NURUL FATIHAH",
          "2024433328": "REBECCA RUDANG ANAK TIMOTHY",
          "2024604928": "REUBEN JAMES DEALWIS",
          "2024236022": "SITI ZAHIDAH BINTI MOHD RONIE",
          "2024696532": "WAHDANIA AYUMIE ANATASYA"
        };

        const ResourceType = {
          PHYSICAL: 'Physical Book',
          EBOOK: 'E-Book',
          THESIS: 'Digital Thesis',
          JOURNAL: 'Online Journal'
        };

        const Genre = {
            TECH: 'Technology & Computing',
            BUSINESS: 'Business & Management',
            FICTION: 'Literature & Fiction',
            RESEARCH: 'Academic Research',
            SCIENCE: 'Science & Environment',
            HISTORY: 'History & Culture'
        };

        // Expanded Data with Genres and Summaries
        const initialResults = [
            {
              id: '1',
              title: 'Management of Digital Transformation',
              author: 'Dr. Marlita Mad Yusuf',
              year: 2024,
              type: ResourceType.PHYSICAL,
              genre: Genre.BUSINESS,
              shelfLocation: 'Level 2, Aisle 4, Shelf B',
              callNumber: 'HD30.2 .M37 2024',
              availability: 'Available',
              coverImage: 'https://picsum.photos/150/220?random=1',
              summary: 'A comprehensive guide on navigating the complexities of digital transformation in modern organizations. This book explores strategic frameworks, leadership roles, and the cultural shifts necessary for successful digitalization in the business sector.'
            },
            {
              id: '2',
              title: 'The Adventures of Huckleberry Finn',
              author: 'Mark Twain',
              year: 1884,
              type: ResourceType.EBOOK,
              genre: Genre.FICTION,
              downloadUrl: '#',
              availability: 'Digital Access',
              coverImage: 'https://picsum.photos/150/220?random=2',
              summary: 'A classic American novel that follows the journey of a young boy named Huck Finn and a runaway slave named Jim as they raft down the Mississippi River. The story offers a scathing satire on entrenched attitudes, particularly racism, of the pre-Civil War South.'
            },
            {
              id: '3',
              title: 'Impact of AI on Academic Libraries',
              author: 'Afiq Haiqal',
              year: 2023,
              type: ResourceType.THESIS,
              genre: Genre.RESEARCH,
              availability: 'Digital Access',
              coverImage: 'https://picsum.photos/150/220?random=3',
              summary: 'This thesis investigates the transformative role of Artificial Intelligence in academic libraries. It analyzes how AI tools are reshaping cataloging, user services, and research assistance, while also addressing the ethical implications of data privacy.'
            },
            {
              id: '4',
              title: 'Strategic Information Systems Planning',
              author: 'Wahdania Ayumie',
              year: 2022,
              type: ResourceType.JOURNAL,
              genre: Genre.BUSINESS,
              availability: 'Digital Access',
              coverImage: 'https://picsum.photos/150/220?random=4',
              summary: 'An in-depth analysis of methodologies for aligning information systems with business goals. This journal article proposes a new framework for strategic planning that accounts for rapid technological obsolescence and agile business environments.'
            },
            {
              id: '5',
              title: 'Clean Code: A Handbook of Agile Software Craftsmanship',
              author: 'Robert C. Martin',
              year: 2008,
              type: ResourceType.PHYSICAL,
              genre: Genre.TECH,
              shelfLocation: 'Level 3, Aisle 1, Shelf A',
              callNumber: 'QA76.76 .C65 M37',
              availability: 'On Loan',
              coverImage: 'https://picsum.photos/150/220?random=5',
              summary: 'A must-read for software developers, this book presents best practices for writing clean, maintainable, and readable code. It covers principles such as meaningful naming, function structure, and error handling to improve software quality.'
            },
            {
              id: '6',
              title: 'Introduction to Algorithms',
              author: 'Thomas H. Cormen',
              year: 2022,
              type: ResourceType.EBOOK,
              genre: Genre.TECH,
              availability: 'Digital Access',
              coverImage: 'https://picsum.photos/150/220?random=6',
              summary: 'The standard textbook for algorithms, covering a broad range of algorithms in depth. It makes their design and analysis accessible to all levels of readers, with self-contained chapters and pseudocode that is easy to understand.'
            },
            {
              id: '7',
              title: 'User Experience Design for Mobile',
              author: 'Sarah Doody',
              year: 2023,
              type: ResourceType.JOURNAL,
              genre: Genre.TECH,
              availability: 'Digital Access',
              coverImage: 'https://picsum.photos/150/220?random=7',
              summary: 'This paper explores current trends in mobile UX design, focusing on gesture-based interactions, dark mode implementation, and accessibility standards for diverse user bases in the smartphone era.'
            },
            {
              id: '8',
              title: 'Sustainable Architecture in Tropics',
              author: 'Dr. Aminah Binti Ahmad',
              year: 2021,
              type: ResourceType.THESIS,
              genre: Genre.SCIENCE,
              availability: 'Digital Access',
              coverImage: 'https://picsum.photos/150/220?random=8',
              summary: 'A research study on passive cooling techniques and sustainable material usage in tropical climates. The thesis provides case studies of energy-efficient buildings in Southeast Asia and proposes new guidelines for green construction.'
            },
            {
              id: '9',
              title: 'Modern Operating Systems',
              author: 'Andrew S. Tanenbaum',
              year: 2014,
              type: ResourceType.PHYSICAL,
              genre: Genre.TECH,
              shelfLocation: 'Level 2, Aisle 10, Shelf D',
              callNumber: 'QA76.76 .O63 T36',
              availability: 'Available',
              coverImage: 'https://picsum.photos/150/220?random=9',
              summary: 'A detailed look at operating system concepts, including processes, memory management, file systems, and security. This edition includes coverage of the latest developments in cloud computing and virtualization.'
            },
            {
              id: '10',
              title: 'Deep Learning',
              author: 'Ian Goodfellow',
              year: 2016,
              type: ResourceType.EBOOK,
              genre: Genre.TECH,
              availability: 'Digital Access',
              coverImage: 'https://picsum.photos/150/220?random=10',
              summary: 'The definitive textbook on deep learning, covering mathematical foundations, machine learning best practices, and applications in speech recognition, computer vision, and natural language processing.'
            },
            {
              id: '11',
              title: 'Malaysian Economy: Past, Present & Future',
              author: 'Prof. Jomo K.S.',
              year: 2020,
              type: ResourceType.PHYSICAL,
              genre: Genre.BUSINESS,
              shelfLocation: 'Level 1, Aisle 2, Shelf F',
              callNumber: 'HC445.5 .J66 2020',
              availability: 'Available',
              coverImage: 'https://picsum.photos/150/220?random=11',
              summary: 'An economic analysis of Malaysia\'s development journey. The book examines historical policies, the impact of globalization, and future economic challenges facing the nation in a post-2020 landscape.'
            },
            {
              id: '12',
              title: 'Cybersecurity Trends in 2024',
              author: 'Tech Journal Weekly',
              year: 2024,
              type: ResourceType.JOURNAL,
              genre: Genre.TECH,
              availability: 'Digital Access',
              coverImage: 'https://picsum.photos/150/220?random=12',
              summary: 'A special report on the emerging threats in the cyber landscape for 2024. Topics include AI-driven phishing attacks, quantum cryptography vulnerabilities, and the rise of ransomware-as-a-service.'
            },
            {
              id: '13',
              title: 'The Pragmatic Programmer',
              author: 'Andrew Hunt',
              year: 1999,
              type: ResourceType.EBOOK,
              genre: Genre.TECH,
              availability: 'Digital Access',
              coverImage: 'https://picsum.photos/150/220?random=13',
              summary: 'This classic guide offers practical advice on software development, covering topics such as fighting software rot, avoiding duplication, writing flexible code, and effective testing strategies.'
            },
            {
              id: '14',
              title: 'Artificial Intelligence: A Modern Approach',
              author: 'Stuart Russell',
              year: 2020,
              type: ResourceType.PHYSICAL,
              genre: Genre.TECH,
              shelfLocation: 'Level 4, Aisle 12',
              callNumber: 'Q335 .R86 2020',
              availability: 'Available',
              coverImage: 'https://picsum.photos/150/220?random=14',
              summary: 'The leading textbook in AI, providing a comprehensive overview of the field. It covers everything from problem-solving and knowledge representation to machine learning and robotics.'
            },
            {
              id: '15',
              title: 'Nature: International Weekly Journal of Science',
              author: 'Nature Publishing Group',
              year: 2024,
              type: ResourceType.JOURNAL,
              genre: Genre.SCIENCE,
              availability: 'Digital Access',
              coverImage: 'https://picsum.photos/150/220?random=15',
              summary: 'The latest issue of Nature, featuring groundbreaking research in genetics, climate change modeling, and astrophysics. Includes peer-reviewed articles and commentary from leading scientists.'
            },
            {
              id: '16',
              title: 'Design Patterns: Elements of Reusable Object-Oriented Software',
              author: 'Erich Gamma',
              year: 1994,
              type: ResourceType.PHYSICAL,
              genre: Genre.TECH,
              shelfLocation: 'Level 3, Aisle 5',
              callNumber: 'QA76.64 .D47 1994',
              availability: 'Available',
              coverImage: 'https://picsum.photos/150/220?random=16',
              summary: 'A seminal book cataloging 23 classic software design patterns. It provides solutions to common problems in software design, helping developers create more flexible, elegant, and reusable object-oriented software.'
            },
            {
              id: '17',
              title: 'Cloud Computing Architectures in Public Sector',
              author: 'Nurul Hidayah',
              year: 2023,
              type: ResourceType.THESIS,
              genre: Genre.RESEARCH,
              availability: 'Digital Access',
              coverImage: 'https://picsum.photos/150/220?random=17',
              summary: 'This thesis evaluates the adoption of cloud computing in government agencies. It proposes a hybrid cloud architecture to balance data sovereignty requirements with the scalability benefits of public clouds.'
            },
            {
              id: '18',
              title: 'Quantum Computing for Everyone',
              author: 'Chris Bernhardt',
              year: 2019,
              type: ResourceType.EBOOK,
              genre: Genre.TECH,
              availability: 'Digital Access',
              coverImage: 'https://picsum.photos/150/220?random=18',
              summary: 'An accessible introduction to quantum computing. The book explains the basic principles of qubits, entanglement, and quantum algorithms without requiring advanced mathematics.'
            },
            {
              id: '19',
              title: 'Harvard Business Review',
              author: 'Harvard Business Publishing',
              year: 2023,
              type: ResourceType.JOURNAL,
              genre: Genre.BUSINESS,
              availability: 'Digital Access',
              coverImage: 'https://picsum.photos/150/220?random=19',
              summary: 'The premier magazine for management professionals. This issue focuses on leadership in the era of hybrid work, sustainable business practices, and navigating global economic uncertainty.'
            },
            {
              id: '20',
              title: 'Harry Potter and the Philosopher\'s Stone',
              author: 'J.K. Rowling',
              year: 1997,
              type: ResourceType.PHYSICAL,
              genre: Genre.FICTION,
              shelfLocation: 'Level 1, Fiction Section',
              callNumber: 'PR6068 .O93 H37',
              availability: 'Available',
              coverImage: 'https://picsum.photos/150/220?random=20',
              summary: 'The first novel in the Harry Potter series. It introduces Harry, a young wizard who discovers his magical heritage and attends Hogwarts School of Witchcraft and Wizardry, where he makes friends and faces the dark wizard Voldemort.'
            },
            {
              id: '21',
              title: 'IEEE Transactions on Software Engineering',
              author: 'IEEE Computer Society',
              year: 2024,
              type: ResourceType.JOURNAL,
              genre: Genre.TECH,
              availability: 'Digital Access',
              coverImage: 'https://picsum.photos/150/220?random=21',
              summary: 'A monthly peer-reviewed scientific journal publishing research on the specification, design, development, and maintenance of software systems.'
            },
            // Additional Books
            {
              id: '22',
              title: 'Sapiens: A Brief History of Humankind',
              author: 'Yuval Noah Harari',
              year: 2011,
              type: ResourceType.EBOOK,
              genre: Genre.HISTORY,
              availability: 'Digital Access',
              coverImage: 'https://picsum.photos/150/220?random=22',
              summary: 'A thought-provoking survey of the history of our species, Homo sapiens. Harari explores how biology and history have defined us and enhanced our understanding of what it means to be human.'
            },
            {
              id: '23',
              title: 'The Great Gatsby',
              author: 'F. Scott Fitzgerald',
              year: 1925,
              type: ResourceType.PHYSICAL,
              genre: Genre.FICTION,
              shelfLocation: 'Level 1, Fiction Section',
              callNumber: 'PS3511.I9 G7',
              availability: 'Available',
              coverImage: 'https://picsum.photos/150/220?random=23',
              summary: 'A novel set in the Jazz Age on Long Island. It tells the story of the mysterious millionaire Jay Gatsby and his obsession with the beautiful former debutante Daisy Buchanan, exploring themes of decadence and idealism.'
            },
            {
              id: '24',
              title: 'Blue Ocean Strategy',
              author: 'W. Chan Kim',
              year: 2005,
              type: ResourceType.PHYSICAL,
              genre: Genre.BUSINESS,
              shelfLocation: 'Level 2, Business',
              callNumber: 'HD30.28 .K56 2005',
              availability: 'Available',
              coverImage: 'https://picsum.photos/150/220?random=24',
              summary: 'A marketing theory that suggests companies are better off searching for ways to gain "uncontested market space" (Blue Oceans) rather than competing with similar companies in existing markets (Red Oceans).'
            },
             {
              id: '25',
              title: 'Analysis of Malay Manuscripts',
              author: 'Dr. Fauzi Deraman',
              year: 2022,
              type: ResourceType.THESIS,
              genre: Genre.HISTORY,
              availability: 'Digital Access',
              coverImage: 'https://picsum.photos/150/220?random=25',
              summary: 'A philological and historical analysis of ancient Malay manuscripts preserved in the national archives. The thesis focuses on the evolution of the Jawi script and the cultural contexts of the 18th century.'
            }
        ];

        const roomData = [
            { id: '1', name: 'Discussion Room 1', capacity: 4, status: 'Occupied', nextAvailable: '14:00 PM' },
            { id: '2', name: 'Discussion Room 2', capacity: 6, status: 'Available' },
            { id: '3', name: 'Quiet Pod A', capacity: 1, status: 'Available' },
            { id: '4', name: 'Media Room', capacity: 10, status: 'Maintenance' },
        ];

        const initialAnalyticsData = [
            { name: 'Sci-Fi', value: 400, color: 'bg-purple-500' },
            { name: 'History', value: 300, color: 'bg-green-400' },
            { name: 'Tech', value: 550, color: 'bg-yellow-400' },
            { name: 'Biz', value: 200, color: 'bg-orange-400' },
        ];

        // --- Helper Function for Download ---
        const handleDownload = (book) => {
            const content = `PTAR NEXUS LIBRARY\n\nResource: ${book.title}\nAuthor: ${book.author}\nType: ${book.type}\nYear: ${book.year}\n\nThis is a placeholder file confirming that the download functionality is active for this digital resource.`;
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.setAttribute('download', `${book.title.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.txt`);
            document.body.appendChild(link);
            link.click();
            link.remove();
            window.URL.revokeObjectURL(url);
        };

        // --- Components ---

        const LoginScreen = ({ onLogin }) => {
            const [studentId, setStudentId] = useState('');
            const [error, setError] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                const trimmedId = studentId.trim();
                
                if (trimmedId && studentDatabase[trimmedId]) {
                    const studentName = studentDatabase[trimmedId];
                    const nameParts = studentName.split(' ').filter(part => part.trim() !== '');
                    const initialsName = nameParts.length >= 2 
                        ? `${nameParts[0]}+${nameParts[1]}` 
                        : nameParts[0];

                    onLogin({
                        name: studentName,
                        studentId: trimmedId,
                        avatarUrl: `https://ui-avatars.com/api/?name=${initialsName}&background=random&color=fff`,
                        department: 'Faculty of Business Management'
                    });
                } else {
                    setError('Invalid Student ID. ID not found in the current semester database.');
                }
            };

            return (
                <div className="flex h-dvh w-full items-center justify-center bg-nexus-dark bg-[url('https://images.unsplash.com/photo-1507842217121-9e962835bf0e?q=80&w=2000&auto=format&fit=crop')] bg-cover bg-center overflow-hidden">
                    <div className="absolute inset-0 bg-nexus-dark/80 backdrop-blur-sm"></div>
                    
                    <div className="relative z-10 w-full max-w-[90%] md:max-w-md p-6 md:p-8 bg-white/10 backdrop-blur-xl border border-white/20 rounded-3xl shadow-2xl animate-fade-in mx-auto">
                        <div className="flex flex-col items-center mb-8">
                            <div className="flex items-center gap-4 mb-4">
                                <div className="w-14 h-14 md:w-16 md:h-16 rounded-2xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center shadow-lg shadow-purple-500/30">
                                    <i className="fa-solid fa-layer-group text-white text-2xl md:text-3xl"></i>
                                </div>
                            </div>
                            <h1 className="text-2xl md:text-3xl font-bold text-white tracking-wide text-center">PTAR <span className="text-purple-400">NEXUS</span></h1>
                            <p className="text-gray-400 mt-2 text-sm md:text-base text-center">Sign in to your digital library</p>
                        </div>

                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div>
                                <label className="block text-sm font-medium text-gray-300 mb-2">Student ID</label>
                                <div className="relative">
                                    <span className="absolute left-4 top-3.5 text-gray-400"><i className="fa-solid fa-id-badge"></i></span>
                                    <input 
                                        type="text" 
                                        value={studentId}
                                        onChange={(e) => {
                                            setStudentId(e.target.value);
                                            setError('');
                                        }}
                                        className="w-full pl-11 pr-4 py-3 bg-black/20 border border-white/10 rounded-xl text-white focus:outline-none focus:border-purple-500 focus:bg-black/40 transition-all text-sm md:text-base"
                                        placeholder="e.g. 2024441674"
                                    />
                                </div>
                            </div>
                            
                            {error && (
                                <div className="p-3 rounded-lg bg-red-500/20 border border-red-500/30 text-red-200 text-xs md:text-sm text-center">
                                    <i className="fa-solid fa-circle-exclamation mr-2"></i>
                                    {error}
                                </div>
                            )}

                            <button 
                                type="submit" 
                                className="w-full py-3.5 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold rounded-xl shadow-lg shadow-purple-900/40 transition-all transform hover:scale-[1.02] text-sm md:text-base"
                            >
                                Sign In
                            </button>
                        </form>
                        
                        <div className="mt-8 text-center">
                             <p className="text-xs text-gray-500 mb-2">Registered Students Only</p>
                             <div className="text-[10px] text-gray-600 font-mono">
                                Try: 2024441674 or 2024696532
                             </div>
                        </div>
                    </div>
                </div>
            );
        };

        const Sidebar = ({ activeTab, setActiveTab, onLogout }) => {
            const menuItems = [
                { id: 'dashboard', icon: 'fa-table-columns', label: 'Dashboard' },
                { id: 'search', icon: 'fa-magnifying-glass', label: 'Search' },
                { id: 'rooms', icon: 'fa-people-roof', label: 'Room Booking' },
                { id: 'digital-id', icon: 'fa-id-card', label: 'My Digital ID' },
                { id: 'analytics', icon: 'fa-chart-line', label: 'Analytics' },
            ];

            return (
                <aside className="w-16 md:w-20 lg:w-64 h-full flex flex-col transition-all duration-300 bg-nexus-dark/80 backdrop-blur-xl border-r border-nexus-glassBorder z-20 flex-shrink-0">
                    <div className="h-20 md:h-24 flex flex-col lg:flex-row items-center justify-center lg:justify-start lg:px-6 border-b border-nexus-glassBorder gap-2">
                        <div className="flex items-center gap-2">
                            <div className="w-8 h-8 md:w-10 md:h-10 rounded-lg bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center shadow-lg shadow-purple-500/30 flex-shrink-0">
                                <i className="fa-solid fa-layer-group text-white text-lg md:text-xl"></i>
                            </div>
                        </div>
                        <span className="hidden lg:block font-bold text-lg text-white tracking-wide leading-tight">
                            PTAR <span className="text-purple-400">NEXUS</span>
                        </span>
                    </div>

                    <nav className="flex-1 py-4 md:py-6 flex flex-col gap-2 px-2 md:px-3 overflow-y-auto scrollbar-hide">
                        {menuItems.map((item) => (
                            <button
                                key={item.id}
                                onClick={() => setActiveTab(item.id)}
                                className={`flex items-center justify-center lg:justify-start p-2 md:p-3 rounded-xl transition-all duration-200 group ${
                                    activeTab === item.id
                                        ? 'bg-purple-600 text-white shadow-lg shadow-purple-600/20'
                                        : 'text-gray-400 hover:bg-white/5 hover:text-white'
                                }`}
                            >
                                <i className={`fa-solid ${item.icon} w-6 text-center text-lg ${activeTab === item.id ? 'text-white' : 'text-gray-400 group-hover:text-purple-400'}`}></i>
                                <span className="hidden lg:block ml-3 font-medium whitespace-nowrap">{item.label}</span>
                            </button>
                        ))}
                    </nav>

                    <div className="p-2 md:p-4 border-t border-nexus-glassBorder">
                        <button 
                            onClick={onLogout}
                            className="flex items-center justify-center lg:justify-start w-full p-2 md:p-3 rounded-xl text-gray-400 hover:bg-red-500/10 hover:text-red-400 transition-colors"
                        >
                            <i className="fa-solid fa-arrow-right-from-bracket w-6 text-center"></i>
                            <span className="hidden lg:block ml-3 font-medium">Logout</span>
                        </button>
                    </div>
                </aside>
            );
        };

        const Header = ({ user, isOnline, setIsOnline, notifications }) => {
            const [showNotifDropdown, setShowNotifDropdown] = useState(false);
            const fullName = user.name; 
            const unreadCount = notifications.length;

            return (
                <header className="h-16 md:h-20 px-4 md:px-6 flex items-center justify-between bg-nexus-dark/60 backdrop-blur-md sticky top-0 z-10 border-b border-nexus-glassBorder flex-shrink-0">
                    <div className="overflow-hidden mr-4">
                        <h1 className="text-base md:text-xl font-bold text-white truncate">
                            Hi, <span className="text-purple-400">{fullName}</span>
                        </h1>
                        <p className="text-[10px] md:text-sm text-gray-400 truncate hidden sm:block">{user.department}</p>
                    </div>

                    <div className="flex items-center gap-3 md:gap-6">
                        <div 
                            onClick={() => setIsOnline(!isOnline)}
                            className={`cursor-pointer px-2 py-1 md:px-4 md:py-2 rounded-full border flex items-center gap-2 transition-all duration-300 ${
                                isOnline 
                                    ? 'bg-green-500/10 border-green-500/30 text-green-400' 
                                    : 'bg-red-500/10 border-red-500/30 text-red-400'
                            }`}
                        >
                            <div className={`w-1.5 h-1.5 md:w-2 md:h-2 rounded-full ${isOnline ? 'bg-green-400 animate-pulse' : 'bg-red-400'}`}></div>
                            <span className="text-[10px] md:text-sm font-semibold hidden md:inline">{isOnline ? 'Online' : 'Offline'}</span>
                        </div>

                        <div className="flex items-center gap-3 pl-3 md:pl-6 border-l border-nexus-glassBorder relative">
                            {/* Notification Bell */}
                            <button 
                                onClick={() => setShowNotifDropdown(!showNotifDropdown)}
                                className="w-8 h-8 md:w-10 md:h-10 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-white transition-colors relative"
                            >
                                <i className="fa-solid fa-bell text-sm md:text-base"></i>
                                {unreadCount > 0 && (
                                    <span className="absolute top-0 right-0 w-4 h-4 bg-red-500 rounded-full text-[10px] flex items-center justify-center font-bold border-2 border-nexus-dark">{unreadCount}</span>
                                )}
                            </button>
                            
                            {/* Dropdown */}
                            {showNotifDropdown && (
                                <div className="absolute top-12 right-2 md:right-12 w-72 bg-slate-800 border border-white/10 rounded-xl shadow-2xl overflow-hidden z-50 animate-fade-in">
                                    <div className="px-4 py-3 border-b border-white/10 bg-slate-900/50">
                                        <h4 className="text-sm font-semibold text-white">Notifications</h4>
                                    </div>
                                    <div className="max-h-64 overflow-y-auto">
                                        {notifications.length === 0 ? (
                                            <div className="p-4 text-center text-gray-500 text-xs">No new notifications</div>
                                        ) : (
                                            notifications.map((notif, idx) => (
                                                <div key={idx} className="p-3 border-b border-white/5 hover:bg-white/5 transition-colors">
                                                    <p className="text-xs text-gray-300">{notif.message}</p>
                                                    <span className="text-[10px] text-gray-500 mt-1 block">{notif.time}</span>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>
                            )}
                            
                            <img 
                                src={user.avatarUrl} 
                                alt={user.name} 
                                className="w-8 h-8 md:w-10 md:h-10 rounded-full border-2 border-purple-500/50 object-cover"
                            />
                        </div>
                    </div>
                </header>
            );
        };

        const BookDetailModal = ({ book, onClose, onToggleBorrow, isBorrowed }) => {
            if (!book) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" onClick={onClose}></div>
                    <div className="relative bg-slate-900 border border-white/10 rounded-2xl w-full max-w-2xl max-h-[90dvh] shadow-2xl flex flex-col md:flex-row overflow-hidden animate-fade-in">
                        {/* Close Button */}
                        <button onClick={onClose} className="absolute top-3 right-3 z-10 w-8 h-8 rounded-full bg-black/50 text-white flex items-center justify-center hover:bg-white/20 transition-colors">
                            <i className="fa-solid fa-xmark"></i>
                        </button>

                        {/* Image Section */}
                        <div className="w-full md:w-1/3 h-48 md:h-auto relative flex-shrink-0">
                            <img src={book.coverImage} alt={book.title} className="w-full h-full object-cover" />
                            <div className="absolute inset-0 bg-gradient-to-t from-slate-900 to-transparent md:hidden"></div>
                        </div>

                        {/* Content Section */}
                        <div className="p-6 md:p-8 flex-1 flex flex-col min-h-0">
                            <div className="mb-4">
                                <div className="flex items-center gap-2 mb-2 flex-wrap">
                                     <span className="px-2 py-1 rounded text-xs font-bold bg-purple-500/20 text-purple-300 border border-purple-500/30">{book.type}</span>
                                     <span className="px-2 py-1 rounded text-xs font-bold bg-white/10 text-gray-300 border border-white/10">{book.genre}</span>
                                </div>
                                <h2 className="text-xl md:text-2xl font-bold text-white leading-tight mb-1">{book.title}</h2>
                                <p className="text-base text-gray-400">by <span className="text-gray-200">{book.author}</span> <span className="text-gray-600 mx-1">•</span> Published: <span className="text-gray-200">{book.year}</span></p>
                            </div>

                            <div className="flex-1 overflow-y-auto mb-6 pr-2 scrollbar-hide">
                                <h3 className="text-xs font-semibold text-gray-500 mb-2 uppercase tracking-wider">Summary</h3>
                                <p className="text-gray-300 text-sm leading-relaxed">{book.summary}</p>
                            </div>

                            <div className="flex gap-3 mt-auto pt-4 border-t border-white/5">
                                 {/* Action Buttons based on type */}
                                 {book.type === ResourceType.PHYSICAL ? (
                                     <button
                                        onClick={() => onToggleBorrow(book)}
                                        className={`flex-1 py-3 px-4 rounded-xl font-bold transition-all text-sm flex items-center justify-center gap-2 ${isBorrowed ? 'bg-red-500/20 hover:bg-red-500 hover:text-white text-red-300 border border-red-500/50' : 'bg-green-500/20 hover:bg-green-500 hover:text-black text-green-300 border border-green-500/50'}`}
                                     >
                                        <i className={`fa-solid ${isBorrowed ? 'fa-rotate-left' : 'fa-book-open'}`}></i>
                                        {isBorrowed ? 'Return Book' : 'Borrow Book'}
                                     </button>
                                 ) : (
                                     <button 
                                        onClick={() => handleDownload(book)}
                                        className="flex-1 py-3 px-4 rounded-xl font-bold bg-cyan-500/20 hover:bg-cyan-500 hover:text-black text-cyan-300 border border-cyan-500/50 transition-all text-sm flex items-center justify-center gap-2"
                                     >
                                        <i className="fa-regular fa-file-pdf"></i>
                                        Download PDF
                                     </button>
                                 )}
                            </div>
                        </div>
                    </div>
                </div>
            )
        };

        const UnifiedSearch = ({ borrowedBooks, onToggleBorrow, likedBooks, onToggleLike }) => {
            const [query, setQuery] = useState('');
            const [activeType, setActiveType] = useState('ALL'); // ALL, PHYSICAL, EBOOK, THESIS, JOURNAL
            const [selectedBook, setSelectedBook] = useState(null);
            
            // Filter logic
            const filteredResults = initialResults.filter(item => {
                const matchesQuery = item.title.toLowerCase().includes(query.toLowerCase()) || 
                                     item.author.toLowerCase().includes(query.toLowerCase());
                
                let matchesType = true;
                if (activeType === 'PHYSICAL') matchesType = item.type === ResourceType.PHYSICAL;
                else if (activeType === 'EBOOK') matchesType = item.type === ResourceType.EBOOK;
                else if (activeType === 'THESIS') matchesType = item.type === ResourceType.THESIS;
                else if (activeType === 'JOURNAL') matchesType = item.type === ResourceType.JOURNAL;

                return matchesQuery && matchesType;
            });

            // Group by Genre for 'ALL' view
            const groupedResults = {};
            if (activeType === 'ALL') {
                Object.values(Genre).forEach(genre => {
                    const booksInGenre = filteredResults.filter(b => b.genre === genre);
                    if (booksInGenre.length > 0) {
                        groupedResults[genre] = booksInGenre;
                    }
                });
            }

            const ResultCard = ({ result, onBookClick }) => {
                const isBorrowed = borrowedBooks.has(result.id);
                const isLiked = likedBooks.has(result.id);

                return (
                    <div 
                        className="flex flex-row bg-white/5 backdrop-blur-sm border border-white/10 rounded-xl overflow-hidden hover:bg-white/10 hover:border-purple-500/30 transition-all duration-300 group h-full cursor-pointer relative"
                        onClick={() => onBookClick(result)}
                    >
                        <div className="w-24 md:w-32 flex-shrink-0 relative">
                            <img 
                                src={result.coverImage} 
                                alt={result.title} 
                                className="w-full h-full object-cover"
                            />
                            <div className="absolute top-2 left-2 flex flex-col gap-1">
                                {result.type === ResourceType.PHYSICAL && (
                                    <span className="px-1.5 py-0.5 md:px-2 md:py-1 bg-amber-500/90 text-black text-[9px] md:text-[10px] font-bold rounded shadow-md">Physical</span>
                                )}
                                {result.type === ResourceType.EBOOK && (
                                    <span className="px-1.5 py-0.5 md:px-2 md:py-1 bg-purple-500/90 text-white text-[9px] md:text-[10px] font-bold rounded shadow-md">E-Book</span>
                                )}
                                {result.type === ResourceType.THESIS && (
                                    <span className="px-1.5 py-0.5 md:px-2 md:py-1 bg-blue-500/90 text-white text-[9px] md:text-[10px] font-bold rounded shadow-md">Thesis</span>
                                )}
                                {result.type === ResourceType.JOURNAL && (
                                    <span className="px-1.5 py-0.5 md:px-2 md:py-1 bg-emerald-500/90 text-white text-[9px] md:text-[10px] font-bold rounded shadow-md">Journal</span>
                                )}
                            </div>
                        </div>
                        
                        <div className="p-3 md:p-4 flex flex-col justify-between flex-1 min-w-0">
                            <div>
                                <div className="text-[9px] md:text-[10px] text-purple-300 uppercase font-bold tracking-wider mb-1 truncate">{result.genre}</div>
                                <h4 className="text-white font-bold text-sm md:text-base leading-tight mb-1 line-clamp-2 group-hover:text-purple-300 transition-colors">{result.title}</h4>
                                <p className="text-gray-400 text-xs mb-2 truncate">{result.author} • {result.year}</p>
                                
                                {result.type === ResourceType.PHYSICAL ? (
                                    <div className="flex items-start gap-2 text-xs text-gray-300 bg-white/5 p-2 rounded-lg">
                                        <i className="fa-solid fa-location-dot mt-0.5 text-amber-400 flex-shrink-0"></i>
                                        <div className="overflow-hidden min-w-0">
                                            <p className="font-medium text-amber-200 truncate">{result.shelfLocation}</p>
                                            <p className="text-[10px] opacity-70 truncate">Call No: {result.callNumber}</p>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="flex items-center gap-2 text-xs text-gray-300 bg-white/5 p-2 rounded-lg">
                                        <i className="fa-solid fa-cloud-arrow-down text-cyan-400 flex-shrink-0"></i>
                                        <p className="font-medium text-cyan-200 truncate">Instant Access</p>
                                    </div>
                                )}
                            </div>

                            <div className="mt-3 flex gap-2">
                                {result.type === ResourceType.PHYSICAL ? (
                                    <button 
                                        onClick={(e) => {
                                            e.stopPropagation(); // Prevent opening modal when clicking action button
                                            onToggleBorrow(result);
                                        }}
                                        className={`flex-1 py-1.5 px-2 md:px-3 border rounded-lg text-[10px] md:text-xs font-medium transition-all whitespace-nowrap ${
                                            isBorrowed 
                                                ? 'bg-red-500/20 hover:bg-red-500 hover:text-white border-red-500/50 text-red-300' 
                                                : 'bg-white/10 hover:bg-green-500 hover:text-black border-white/20 text-white'
                                        }`}
                                    >
                                        {isBorrowed ? 'Return' : 'Borrow'}
                                    </button>
                                ) : (
                                    <button 
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            handleDownload(result);
                                        }}
                                        className="flex-1 py-1.5 px-2 md:px-3 bg-cyan-600/20 hover:bg-cyan-500 hover:text-black border border-cyan-500/50 text-cyan-300 rounded-lg text-[10px] md:text-xs font-medium transition-all flex items-center justify-center gap-2 whitespace-nowrap"
                                    >
                                            <i className="fa-regular fa-file-pdf"></i> Download
                                    </button>
                                )}
                                <button 
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        onToggleLike(result);
                                    }}
                                    className={`w-8 flex items-center justify-center rounded-lg transition-colors ${isLiked ? 'bg-pink-500/20 text-pink-400 border border-pink-500/30' : 'bg-white/5 hover:bg-white/20 text-white'}`}
                                >
                                    <i className={`${isLiked ? 'fa-solid' : 'fa-regular'} fa-heart`}></i>
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            const filters = [
                { id: 'ALL', label: 'All Resources' },
                { id: 'PHYSICAL', label: 'Books' },
                { id: 'EBOOK', label: 'E-Books' },
                { id: 'THESIS', label: 'Theses' },
                { id: 'JOURNAL', label: 'Journals' },
            ];

            return (
                <div className="w-full max-w-6xl mx-auto relative">
                    {/* Search & Filter Section */}
                    <div className="mb-6 md:mb-8">
                        <div className="relative mb-4 md:mb-6">
                            <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                <i className="fa-solid fa-magnifying-glass text-gray-400 text-lg"></i>
                            </div>
                            <input
                                type="text"
                                className="block w-full pl-12 pr-4 py-3 md:py-4 bg-white/5 backdrop-blur-md border border-white/10 rounded-2xl text-sm md:text-base text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:bg-white/10 transition-all shadow-xl"
                                placeholder="Search by Title, Author, or Keyword..."
                                value={query}
                                onChange={(e) => setQuery(e.target.value)}
                            />
                        </div>

                        {/* Filter Tabs */}
                        <div className="flex gap-2 overflow-x-auto pb-2 scrollbar-hide -mx-2 px-2 md:mx-0 md:px-0">
                            {filters.map(filter => (
                                <button
                                    key={filter.id}
                                    onClick={() => setActiveType(filter.id)}
                                    className={`px-3 py-1.5 md:px-4 md:py-2 rounded-xl text-xs md:text-sm font-medium whitespace-nowrap transition-all flex-shrink-0 ${
                                        activeType === filter.id 
                                        ? 'bg-purple-600 text-white shadow-lg shadow-purple-600/20' 
                                        : 'bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white border border-white/5'
                                    }`}
                                >
                                    {filter.label}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Results Display */}
                    {activeType === 'ALL' && !query ? (
                        // Categorized View (Genres)
                        <div className="space-y-6 md:space-y-8">
                            {Object.entries(groupedResults).map(([genreName, items]) => (
                                <div key={genreName} className="animate-fade-in">
                                    <h3 className="text-white/90 font-bold text-base md:text-lg mb-3 md:mb-4 flex items-center gap-2 border-l-4 border-purple-500 pl-3">
                                        {genreName} <span className="text-gray-500 text-xs md:text-sm font-normal">({items.length})</span>
                                    </h3>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-3 md:gap-4">
                                        {items.map(item => (
                                            <ResultCard key={item.id} result={item} onBookClick={setSelectedBook} />
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>
                    ) : (
                        // Flat Grid View (Specific Filter or Search)
                        <div>
                             <h3 className="text-white/80 font-semibold text-base mb-4 flex items-center">
                                <i className="fa-solid fa-layer-group mr-2"></i> 
                                {query ? `Search Results for "${query}"` : `${filters.find(f => f.id === activeType).label}`} ({filteredResults.length})
                            </h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-3 md:gap-6">
                                {filteredResults.map((result) => (
                                    <ResultCard key={result.id} result={result} onBookClick={setSelectedBook} />
                                ))}
                            </div>
                            {filteredResults.length === 0 && (
                                <div className="text-center py-20 text-gray-500">
                                    <i className="fa-solid fa-book-open text-4xl mb-4 opacity-50"></i>
                                    <p>No resources found matching your criteria.</p>
                                </div>
                            )}
                        </div>
                    )}

                    {/* Modal */}
                    <BookDetailModal 
                        book={selectedBook} 
                        onClose={() => setSelectedBook(null)} 
                        onToggleBorrow={onToggleBorrow}
                        isBorrowed={selectedBook ? borrowedBooks.has(selectedBook.id) : false}
                    />
                </div>
            );
        };

        const DigitalID = ({ user }) => {
            const [scanning, setScanning] = useState(false);
            const [scanSuccess, setScanSuccess] = useState(false);

            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${user.studentId}&color=6d28d9&bgcolor=ffffff`;

            const handleScan = () => {
                if (scanning || scanSuccess) return;
                setScanning(true);
                setTimeout(() => {
                    setScanning(false);
                    setScanSuccess(true);
                    setTimeout(() => setScanSuccess(false), 3000);
                }, 2000);
            };

            return (
                <div className="bg-white/5 backdrop-blur-md border border-white/10 rounded-2xl p-4 md:p-6 flex flex-col items-center shadow-xl relative overflow-hidden group h-full">
                    <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-purple-500 to-pink-500"></div>
                    
                    <div className="w-full flex justify-between items-center mb-4">
                        <h3 className="text-white font-semibold flex items-center gap-2 text-sm md:text-base">
                            <i className="fa-solid fa-id-card text-purple-400"></i> Digital ID
                        </h3>
                        <span className={`text-[10px] md:text-xs px-2 py-1 rounded border transition-colors ${
                            scanSuccess 
                                ? 'bg-green-500/30 text-green-200 border-green-500' 
                                : 'bg-green-500/20 text-green-300 border-green-500/30'
                        }`}>
                            {scanSuccess ? 'VERIFIED' : 'Active'}
                        </span>
                    </div>

                    <div className="relative bg-white p-2 md:p-3 rounded-xl mb-4 shadow-lg shadow-purple-500/20 group-hover:scale-105 transition-transform duration-300 overflow-hidden">
                        <img src={qrUrl} alt="Student ID QR" className="w-24 h-24 md:w-32 md:h-32" />
                        
                        {scanning && (
                            <div className="absolute inset-0 bg-purple-500/20">
                                <div className="absolute w-full h-1 bg-red-500 shadow-[0_0_15px_rgba(239,68,68,0.8)] animate-scan"></div>
                            </div>
                        )}
                        
                        {scanSuccess && (
                            <div className="absolute inset-0 bg-green-500/90 flex items-center justify-center flex-col animate-fade-in">
                                <i className="fa-solid fa-circle-check text-white text-3xl md:text-4xl mb-2"></i>
                                <span className="text-white font-bold text-xs md:text-sm">Granted</span>
                            </div>
                        )}
                    </div>

                    <p className="text-gray-300 font-mono text-base md:text-lg tracking-wider mb-4">{user.studentId}</p>

                    <button 
                        onClick={handleScan}
                        disabled={scanning || scanSuccess}
                        className={`w-full py-2 md:py-3 rounded-xl font-medium shadow-lg transition-all flex items-center justify-center gap-2 text-sm md:text-base ${
                            scanSuccess 
                                ? 'bg-green-600 text-white cursor-default'
                                : scanning 
                                    ? 'bg-gray-600 text-gray-300 cursor-wait' 
                                    : 'bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white shadow-purple-900/40'
                        }`}
                    >
                        {scanning ? <><i className="fa-solid fa-spinner fa-spin"></i> Connecting...</> : 
                         scanSuccess ? <><i className="fa-solid fa-check"></i> Scanned</> : 
                         <><i className="fa-solid fa-expand"></i> Scan at Kiosk</>}
                    </button>
                </div>
            );
        };

        const RoomBooking = () => {
            return (
                <div className="bg-white/5 backdrop-blur-md border border-white/10 rounded-2xl p-4 md:p-6 shadow-xl h-full">
                    <div className="flex justify-between items-center mb-6">
                        <h3 className="text-white font-semibold flex items-center gap-2 text-sm md:text-base">
                            <i className="fa-solid fa-people-roof text-pink-400"></i> Smart Booking
                        </h3>
                        <button className="text-xs text-purple-300 hover:text-white transition-colors">View All</button>
                    </div>

                    <div className="grid grid-cols-1 gap-3 md:gap-4">
                        {roomData.map((room) => (
                            <div 
                                key={room.id} 
                                className="flex items-center justify-between p-3 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 transition-colors"
                            >
                                <div className="flex items-center gap-3 min-w-0">
                                    <div className={`w-3 h-3 rounded-full shadow-lg flex-shrink-0 ${
                                        room.status === 'Available' ? 'bg-green-500 shadow-green-500/50' : 
                                        room.status === 'Occupied' ? 'bg-red-500 shadow-red-500/50' : 'bg-gray-500'
                                    }`}></div>
                                    <div className="overflow-hidden">
                                        <h4 className="text-white text-xs md:text-sm font-medium truncate">{room.name}</h4>
                                        <p className="text-[10px] md:text-xs text-gray-400">Cap: {room.capacity}</p>
                                    </div>
                                </div>

                                {room.status === 'Available' ? (
                                    <button className="px-2 py-1 md:px-3 md:py-1.5 bg-green-500/20 text-green-300 border border-green-500/30 rounded-lg text-[10px] md:text-xs font-semibold hover:bg-green-500 hover:text-black transition-all whitespace-nowrap ml-2">
                                        Book
                                    </button>
                                ) : room.status === 'Occupied' ? (
                                    <span className="text-[10px] md:text-xs text-red-400 font-medium whitespace-nowrap ml-2">Until {room.nextAvailable}</span>
                                ) : (
                                    <span className="text-[10px] md:text-xs text-gray-500 font-medium ml-2">Closed</span>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const Analytics = () => {
            const [data, setData] = useState(initialAnalyticsData);

            useEffect(() => {
                const interval = setInterval(() => {
                    setData(prevData => prevData.map(item => ({
                        ...item,
                        value: Math.max(10, item.value + Math.floor(Math.random() * 30) - 10)
                    })));
                }, 3000);
                return () => clearInterval(interval);
            }, []);

            const maxVal = Math.max(...data.map(d => d.value));

            return (
                <div className="bg-white/5 backdrop-blur-md border border-white/10 rounded-2xl p-4 md:p-6 shadow-xl h-full flex flex-col">
                    <div className="flex justify-between items-center mb-4">
                        <h3 className="text-white font-semibold flex items-center gap-2 text-sm md:text-base">
                            <i className="fa-solid fa-chart-pie text-cyan-400"></i> Live Analytics
                        </h3>
                        <div className="flex items-center gap-2">
                            <span className="relative flex h-2 w-2">
                              <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                              <span className="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                            </span>
                            <span className="text-[10px] text-green-400 uppercase tracking-wider font-bold">Live</span>
                        </div>
                    </div>

                    <div className="flex-1 w-full flex items-end justify-between gap-2 md:gap-4 mt-4 px-1 md:px-2">
                        {data.map((item, index) => {
                            const heightPercentage = (item.value / (maxVal * 1.2)) * 100;
                            return (
                                <div key={index} className="flex flex-col items-center flex-1 group">
                                    <div className="relative w-full flex justify-center h-28 md:h-40 items-end">
                                        <div className="absolute -top-8 opacity-0 group-hover:opacity-100 transition-opacity bg-slate-800 text-white text-[10px] px-2 py-1 rounded pointer-events-none whitespace-nowrap border border-white/10 z-10">
                                            {item.value} books
                                        </div>
                                        <div 
                                            className={`w-full max-w-[20px] md:max-w-[40px] rounded-t-lg transition-all duration-700 ease-out ${item.color} opacity-80 group-hover:opacity-100`}
                                            style={{ height: `${heightPercentage}%`, minHeight: '4px' }}
                                        ></div>
                                    </div>
                                    <span className="text-[9px] md:text-xs text-gray-400 mt-2 font-medium truncate w-full text-center">{item.name}</span>
                                </div>
                            );
                        })}
                    </div>
                    
                    <p className="text-center text-[10px] text-gray-500 mt-6 pt-4 border-t border-white/5">
                        Real-time RFID Tracking
                    </p>
                </div>
            );
        };

        const App = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [isOnline, setIsOnline] = useState(true);
            const [notifications, setNotifications] = useState([]);
            const [borrowedBooks, setBorrowedBooks] = useState(new Set());
            const [likedBooks, setLikedBooks] = useState(new Set());

            const handleLogin = (userData) => {
                setUser(userData);
                setIsLoggedIn(true);
                addNotification(`Welcome back, ${userData.name.split(' ')[0]}!`);
            };

            const handleLogout = () => {
                setIsLoggedIn(false);
                setUser(null);
                setActiveTab('dashboard');
                setNotifications([]);
                setBorrowedBooks(new Set());
                setLikedBooks(new Set());
            };

            const addNotification = (message) => {
                const newNotif = {
                    message,
                    time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                    read: false
                };
                setNotifications(prev => [newNotif, ...prev]);
            };

            const toggleBorrow = (book) => {
                const newBorrowed = new Set(borrowedBooks);
                if (newBorrowed.has(book.id)) {
                    newBorrowed.delete(book.id);
                    addNotification(`You returned "${book.title}". Thank you!`);
                } else {
                    newBorrowed.add(book.id);
                    addNotification(`You borrowed "${book.title}". Please pick it up at Counter A.`);
                }
                setBorrowedBooks(newBorrowed);
            };

            const toggleLike = (book) => {
                const newLiked = new Set(likedBooks);
                if (newLiked.has(book.id)) {
                    newLiked.delete(book.id);
                } else {
                    newLiked.add(book.id);
                    addNotification(`You liked "${book.title}"`);
                }
                setLikedBooks(newLiked);
            };

            if (!isLoggedIn) {
                return <LoginScreen onLogin={handleLogin} />;
            }

            return (
                <div className="flex h-dvh bg-nexus-dark text-white font-sans overflow-hidden bg-[url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072&auto=format&fit=crop')] bg-cover bg-center">
                    <div className="absolute inset-0 bg-nexus-dark/90 z-0"></div>
                    <div className="absolute inset-0 bg-gradient-to-tr from-purple-900/30 to-blue-900/30 z-0 pointer-events-none"></div>

                    <div className="relative z-10 flex w-full h-full">
                        <Sidebar activeTab={activeTab} setActiveTab={setActiveTab} onLogout={handleLogout} />

                        <main className="flex-1 flex flex-col h-full overflow-hidden relative">
                            
                            <Header 
                                user={user} 
                                isOnline={isOnline} 
                                setIsOnline={setIsOnline} 
                                notifications={notifications}
                            />

                            <div className="flex-1 overflow-y-auto p-4 md:p-6 scrollbar-hide">
                                {!isOnline && (
                                    <div className="w-full bg-red-500/20 border border-red-500/40 text-red-100 p-3 rounded-xl mb-4 flex items-center gap-3 animate-pulse text-sm">
                                        <i className="fa-solid fa-triangle-exclamation"></i>
                                        <p><strong>Offline Mode:</strong> Transactions cached.</p>
                                    </div>
                                )}

                                {activeTab === 'dashboard' && (
                                    <div className="flex flex-col gap-6 max-w-7xl mx-auto pb-10">
                                        <div className="w-full">
                                            <div className="mb-2">
                                                <h2 className="text-xl md:text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-400">Search</h2>
                                                <p className="text-gray-400 text-xs md:text-base">Access all library resources simultaneously.</p>
                                            </div>
                                            <UnifiedSearch 
                                                borrowedBooks={borrowedBooks} 
                                                onToggleBorrow={toggleBorrow} 
                                                likedBooks={likedBooks}
                                                onToggleLike={toggleLike}
                                            />
                                        </div>

                                        <div className="grid grid-cols-1 md:grid-cols-12 gap-4 md:gap-6">
                                            <div className="md:col-span-5 lg:col-span-3">
                                                <DigitalID user={user} />
                                            </div>

                                            <div className="md:col-span-7 lg:col-span-5">
                                                <RoomBooking />
                                            </div>

                                            <div className="md:col-span-12 lg:col-span-4">
                                                <Analytics />
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {activeTab === 'search' && <div className="pb-10">
                                    <UnifiedSearch 
                                        borrowedBooks={borrowedBooks} 
                                        onToggleBorrow={toggleBorrow}
                                        likedBooks={likedBooks}
                                        onToggleLike={toggleLike}
                                    />
                                </div>}
                                {activeTab === 'rooms' && (
                                    <div className="max-w-4xl mx-auto h-full pb-10">
                                        <RoomBooking />
                                    </div>
                                )}
                                {activeTab === 'digital-id' && (
                                    <div className="max-w-md mx-auto mt-10 md:mt-20 h-96 pb-10">
                                        <DigitalID user={user} />
                                    </div>
                                )}
                                {activeTab === 'analytics' && (
                                    <div className="max-w-4xl mx-auto h-[400px] mt-10 pb-10">
                                        <Analytics />
                                    </div>
                                )}
                            </div>
                        </main>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>