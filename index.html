<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>PTAR Nexus V1 | Library Smart Digital Process</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
            colors: {
              nexus: {
                dark: '#0f172a',
                purple: '#6d28d9',
                glass: 'rgba(255, 255, 255, 0.1)',
                glassBorder: 'rgba(255, 255, 255, 0.2)',
              }
            },
            animation: {
              'scan': 'scan 2s linear infinite',
              'fade-in': 'fadeIn 0.3s ease-out',
              'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            },
            keyframes: {
              scan: {
                '0%': { top: '0%' },
                '100%': { top: '100%' },
              },
              fadeIn: {
                '0%': { opacity: '0', transform: 'translateY(-10px)' },
                '100%': { opacity: '1', transform: 'translateY(0)' },
              }
            }
          }
        }
      }
    </script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background-color: #0f172a;
      }
      /* Custom Scrollbar hide */
      .scrollbar-hide::-webkit-scrollbar {
          display: none;
      }
      .scrollbar-hide {
          -ms-overflow-style: none;
          scrollbar-width: none;
      }
      /* Height fix for mobile browsers */
      .h-dvh {
        height: 100vh;
        height: 100dvh;
      }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // --- Mock Data & Constants ---
        
        // Student Database
        const studentDatabase = {
          "2024441674": "AFFIE HAFIZAN KHAN BIN ALIJAN KHAN",
          "2024442374": "AMIRA SYAHAIREEN BINTI SAHDAN",
          "2024267258": "ANDRYSHA NYCHELLE ANAK ANDREW",
          "2024427454": "ARSYAD ZULHUSMI BIN KADAI",
          "2024298694": "BIJANI ANAK BAKAR",
          "2024436676": "CASYLVIA ANN ANAK ARMSTRONG",
          "2024436998": "DEAN DE DVINE JITEK",
          "2024206888": "DELLIA SUNGGAU ANAK DONNY",
          "2024670846": "EDIANA ANAK KAMIL",
          "2024223492": "ESTER AWANG",
          "2024288588": "FERGUSON QIUN ANAK LUTA",
          "2024212352": "HANIS YASMIN BINTI HARDYNORHAN",
          "2024419286": "HASNA NAZIRA BINTI AHMAD ROSALLAN",
          "2024204868": "HAZEL ANAK RITCHIE",
          "2024229294": "JAYCARLSON WILSON",
          "2024206946": "LUQMAN NURHAKIM OMARSHARIFF",
          "2024419516": "MOHAMAD ZAINORAZIEM BIN ZAINAL",
          "2024436008": "MOHammad SYAHRIL AZLIE",
          "2024681454": "MOHD AMIRUL HAFIZ BIN ILAH",
          "2024282012": "MUHAMAD HAZIM AKMAL BIN JAMAN",
          "2024411696": "MUHAMMAD AFIQ HAIQAL BIN MOHD ROSDI",
          "2024645246": "NA'IM ANIQ BIN BASRI",
          "2024299084": "NUR AYUNI BINTI SEPAWI",
          "2024244202": "NUR QAMARINA BINTI UZILA",
          "2024200648": "NUR SYAZA ADRIANA BINTI HASMAN",
          "2024427272": "NURFARAH AININ SOFIYA BINTI MAJELAN",
          "2024207026": "NURUL FARAHANA BINTI ABDULLAH",
          "2024223252": "NURUL FATIHAH",
          "2024433328": "REBECCA RUDANG ANAK TIMOTHY",
          "2024604928": "REUBEN JAMES DEALWIS",
          "2024236022": "SITI ZAHIDAH BINTI MOHD RONIE",
          "2024696532": "WAHDANIA AYUMIE ANATASYA"
        };

        const ResourceType = {
          PHYSICAL: 'Physical Book',
          EBOOK: 'E-Book',
          THESIS: 'Thesis',
          JOURNAL: 'Journal',
          PAPER: 'Exam Paper'
        };

        const Genre = {
            ALL: 'All Resources',
            TECH: 'Technology',
            BUSINESS: 'Business',
            FICTION: 'Fiction',
            SCIENCE: 'Science',
            HISTORY: 'History'
        };

        // Local Physical Inventory (Shelf items)
        const localPhysicalInventory = [
            {
              id: 'local_1',
              title: 'Management of Digital Transformation',
              author: 'Dr. Marlita Mad Yusuf',
              year: 2024,
              type: ResourceType.PHYSICAL,
              genre: Genre.BUSINESS,
              shelfLocation: 'Level 2, Aisle 4, Shelf B',
              callNumber: 'HD30.2 .M37 2024',
              availability: 'Available',
              coverImage: 'https://picsum.photos/150/220?random=1',
              summary: 'A comprehensive guide on navigating the complexities of digital transformation in modern organizations.'
            },
            {
              id: 'local_5',
              title: 'Clean Code: A Handbook of Agile Software Craftsmanship',
              author: 'Robert C. Martin',
              year: 2008,
              type: ResourceType.PHYSICAL,
              genre: Genre.TECH,
              shelfLocation: 'Level 3, Aisle 1, Shelf A',
              callNumber: 'QA76.76 .C65 M37',
              availability: 'On Loan',
              coverImage: 'https://covers.openlibrary.org/b/isbn/9780132350884-M.jpg',
              summary: 'A must-read for software developers, this book presents best practices for writing clean, maintainable, and readable code.'
            },
            {
              id: 'local_9',
              title: 'Modern Operating Systems',
              author: 'Andrew S. Tanenbaum',
              year: 2014,
              type: ResourceType.PHYSICAL,
              genre: Genre.TECH,
              shelfLocation: 'Level 2, Aisle 10, Shelf D',
              callNumber: 'QA76.76 .O63 T36',
              availability: 'Available',
              coverImage: 'https://covers.openlibrary.org/b/isbn/9780133591620-M.jpg',
              summary: 'A detailed look at operating system concepts, including processes, memory management, file systems, and security.'
            },
            {
              id: 'local_11',
              title: 'Malaysian Economy: Past, Present & Future',
              author: 'Prof. Jomo K.S.',
              year: 2020,
              type: ResourceType.PHYSICAL,
              genre: Genre.BUSINESS,
              shelfLocation: 'Level 1, Aisle 2, Shelf F',
              callNumber: 'HC445.5 .J66 2020',
              availability: 'Available',
              coverImage: 'https://picsum.photos/150/220?random=11',
              summary: 'An economic analysis of Malaysia\'s development journey.'
            },
            {
              id: 'local_14',
              title: 'Artificial Intelligence: A Modern Approach',
              author: 'Stuart Russell',
              year: 2020,
              type: ResourceType.PHYSICAL,
              genre: Genre.TECH,
              shelfLocation: 'Level 4, Aisle 12',
              callNumber: 'Q335 .R86 2020',
              availability: 'Available',
              coverImage: 'https://covers.openlibrary.org/b/isbn/9780134610993-M.jpg',
              summary: 'The leading textbook in AI, providing a comprehensive overview of the field.'
            },
            {
              id: 'local_20',
              title: 'Harry Potter and the Philosopher\'s Stone',
              author: 'J.K. Rowling',
              year: 1997,
              type: ResourceType.PHYSICAL,
              genre: Genre.FICTION,
              shelfLocation: 'Level 1, Fiction Section',
              callNumber: 'PR6068 .O93 H37',
              availability: 'Available',
              coverImage: 'https://covers.openlibrary.org/b/isbn/9780747532743-M.jpg',
              summary: 'The first novel in the Harry Potter series.'
            }
        ];

        // Local PTAR Digital Resources (Thesis, Papers, etc.)
        const localDigitalInventory = [
            {
                id: 'dig_1',
                title: 'Thesis: Impact of AI on Malaysian SMEs',
                author: 'Nurul Fatihah (2024223252)',
                year: 2023,
                type: ResourceType.THESIS,
                genre: Genre.BUSINESS,
                availability: 'PTAR Digital',
                coverImage: 'placeholder',
                summary: 'A study on the adoption of Artificial Intelligence in Small and Medium Enterprises in Selangor.'
            },
            {
                id: 'dig_2',
                title: 'Past Year Question: ITS555 - Oct 2023',
                author: 'UiTM Examination Unit',
                year: 2023,
                type: ResourceType.PAPER,
                genre: Genre.TECH,
                availability: 'PTAR Digital',
                coverImage: 'placeholder',
                summary: 'Final Examination Paper for ITS555 Advanced Database Systems.'
            },
            {
                id: 'dig_3',
                title: 'Journal of Computing & Mathematics Vol 12',
                author: 'UiTM Press',
                year: 2024,
                type: ResourceType.JOURNAL,
                genre: Genre.TECH,
                availability: 'PTAR Digital',
                coverImage: 'placeholder',
                summary: 'Compilation of research papers from the Faculty of Computer and Mathematical Sciences.'
            },
            {
                id: 'dig_4',
                title: 'Sejarah Kesultanan Melayu Melaka',
                author: 'Prof. Khoo Kay Kim',
                year: 2015,
                type: ResourceType.EBOOK,
                genre: Genre.HISTORY,
                availability: 'PTAR Digital',
                coverImage: 'placeholder',
                summary: 'A definitive history of the Malacca Sultanate.'
            }
        ];

        const roomData = [
            { id: '1', name: 'Discussion Room 1', capacity: 4, status: 'Occupied', nextAvailable: '14:00 PM' },
            { id: '2', name: 'Discussion Room 2', capacity: 6, status: 'Available' },
            { id: '3', name: 'Quiet Pod A', capacity: 1, status: 'Available' },
            { id: '4', name: 'Media Room', capacity: 10, status: 'Maintenance' },
        ];

        const initialAnalyticsData = [
            { name: 'Sci-Fi', value: 400, color: 'bg-purple-500' },
            { name: 'History', value: 300, color: 'bg-green-400' },
            { name: 'Tech', value: 550, color: 'bg-yellow-400' },
            { name: 'Biz', value: 200, color: 'bg-orange-400' },
        ];

        // --- Components ---
        
        // --- Reader Component for PTAR Online Books ---
        const BookReader = ({ book, onClose }) => {
            const [currentPage, setCurrentPage] = useState(1);
            const totalPages = 15; // Mock total pages

            // Mock content generation based on Genre
            const getContent = (page) => {
                if (page === 1) return `
                    <div class="text-center mt-20">
                        <h1 class="text-4xl font-bold mb-4">${book.title}</h1>
                        <p class="text-xl text-gray-500 mb-8">${book.author}</p>
                        <div class="inline-block px-4 py-2 bg-gray-100 rounded-lg text-sm text-gray-600">
                            ${book.genre} • ${book.year}
                        </div>
                        <p class="mt-20 text-sm text-gray-400">Published by PTAR Digital Press</p>
                    </div>
                `;

                // Generic text content
                return `
                    <div class="text-justify leading-relaxed text-lg text-gray-800">
                        <h3 class="text-xl font-bold mb-4">Chapter ${page - 1}</h3>
                        <p class="mb-4">
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. 
                            Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
                        </p>
                        <p class="mb-4">
                            Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. 
                            Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                        </p>
                        <p class="mb-4">
                            Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, 
                            eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.
                        </p>
                        <div class="p-4 bg-blue-50 border-l-4 border-blue-500 my-6">
                            <p class="text-sm italic text-blue-900">
                                "The capacity to learn is a gift; the ability to learn is a skill; the willingness to learn is a choice."
                            </p>
                        </div>
                         <p>
                            Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos 
                            qui ratione voluptatem sequi nesciunt.
                        </p>
                    </div>
                `;
            };

            return (
                <div className="fixed inset-0 z-[100] bg-slate-900 flex flex-col animate-fade-in">
                    {/* Reader Toolbar */}
                    <div className="h-14 bg-slate-800 border-b border-white/10 flex items-center justify-between px-4 shadow-lg flex-shrink-0">
                        <div className="flex items-center gap-3 text-white overflow-hidden">
                            <i className="fa-solid fa-book-open text-purple-400"></i>
                            <span className="font-semibold truncate max-w-[200px] md:max-w-md">{book.title}</span>
                        </div>
                        
                        <div className="flex items-center gap-4">
                             <div className="hidden md:flex items-center bg-black/30 rounded-lg px-3 py-1 text-sm text-gray-300 gap-2">
                                <span>Page {currentPage} of {totalPages}</span>
                             </div>
                             <button onClick={onClose} className="w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10 text-white transition-colors">
                                <i className="fa-solid fa-xmark text-lg"></i>
                             </button>
                        </div>
                    </div>

                    {/* Reader Body */}
                    <div className="flex-1 bg-neutral-200 overflow-y-auto p-4 md:p-8 flex justify-center relative">
                        {/* Page Container */}
                        <div className="w-full max-w-3xl bg-white shadow-2xl min-h-[80vh] md:min-h-[120vh] p-8 md:p-16 relative">
                            <div dangerouslySetInnerHTML={{ __html: getContent(currentPage) }}></div>
                            
                            {/* Page Number Footer */}
                            <div className="absolute bottom-6 left-0 w-full text-center text-xs text-gray-400">
                                {currentPage}
                            </div>
                        </div>

                        {/* Navigation Overlay Arrows (Desktop) */}
                        <button 
                            disabled={currentPage === 1}
                            onClick={() => setCurrentPage(p => Math.max(1, p - 1))}
                            className={`fixed left-4 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-black/50 text-white flex items-center justify-center hover:bg-black/70 transition-all ${currentPage === 1 ? 'opacity-0 pointer-events-none' : 'opacity-100'}`}
                        >
                            <i className="fa-solid fa-chevron-left"></i>
                        </button>
                        
                        <button 
                            disabled={currentPage === totalPages}
                            onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}
                            className={`fixed right-4 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-black/50 text-white flex items-center justify-center hover:bg-black/70 transition-all ${currentPage === totalPages ? 'opacity-0 pointer-events-none' : 'opacity-100'}`}
                        >
                            <i className="fa-solid fa-chevron-right"></i>
                        </button>
                    </div>

                    {/* Mobile Footer Controls */}
                    <div className="md:hidden h-14 bg-slate-800 border-t border-white/10 flex items-center justify-between px-6 text-white">
                         <button 
                            disabled={currentPage === 1}
                            onClick={() => setCurrentPage(p => Math.max(1, p - 1))}
                            className="p-2 disabled:opacity-30"
                        >
                            <i className="fa-solid fa-chevron-left"></i>
                         </button>
                         <span className="text-sm">Page {currentPage} / {totalPages}</span>
                         <button 
                            disabled={currentPage === totalPages}
                            onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}
                            className="p-2 disabled:opacity-30"
                        >
                            <i className="fa-solid fa-chevron-right"></i>
                         </button>
                    </div>
                </div>
            );
        };

        const LoginScreen = ({ onLogin }) => {
            const [studentId, setStudentId] = useState('');
            const [error, setError] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                const trimmedId = studentId.trim();
                
                if (trimmedId && studentDatabase[trimmedId]) {
                    const studentName = studentDatabase[trimmedId];
                    const nameParts = studentName.split(' ').filter(part => part.trim() !== '');
                    const initialsName = nameParts.length >= 2 
                        ? `${nameParts[0]}+${nameParts[1]}` 
                        : nameParts[0];

                    onLogin({
                        name: studentName,
                        studentId: trimmedId,
                        avatarUrl: `https://ui-avatars.com/api/?name=${initialsName}&background=random&color=fff`,
                        department: 'Faculty of Business Management'
                    });
                } else {
                    setError('Invalid Student ID. ID not found in the current semester database.');
                }
            };

            return (
                <div className="flex h-dvh w-full items-center justify-center bg-nexus-dark bg-[url('https://images.unsplash.com/photo-1507842217121-9e962835bf0e?q=80&w=2000&auto=format&fit=crop')] bg-cover bg-center overflow-hidden">
                    <div className="absolute inset-0 bg-nexus-dark/80 backdrop-blur-sm"></div>
                    
                    <div className="relative z-10 w-full max-w-[90%] md:max-w-md p-6 md:p-8 bg-white/10 backdrop-blur-xl border border-white/20 rounded-3xl shadow-2xl animate-fade-in mx-auto">
                        <div className="flex flex-col items-center mb-8">
                            <div className="flex items-center gap-4 mb-4">
                                <div className="w-14 h-14 md:w-16 md:h-16 rounded-2xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center shadow-lg shadow-purple-500/30">
                                    <i className="fa-solid fa-layer-group text-white text-2xl md:text-3xl"></i>
                                </div>
                            </div>
                            <h1 className="text-2xl md:text-3xl font-bold text-white tracking-wide text-center">PTAR <span className="text-purple-400">NEXUS</span></h1>
                            <p className="text-gray-400 mt-2 text-sm md:text-base text-center">Sign in to your digital library</p>
                        </div>

                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div>
                                <label className="block text-sm font-medium text-gray-300 mb-2">Student ID</label>
                                <div className="relative">
                                    <span className="absolute left-4 top-3.5 text-gray-400"><i className="fa-solid fa-id-badge"></i></span>
                                    <input 
                                        type="text" 
                                        value={studentId}
                                        onChange={(e) => {
                                            setStudentId(e.target.value);
                                            setError('');
                                        }}
                                        className="w-full pl-11 pr-4 py-3 bg-black/20 border border-white/10 rounded-xl text-white focus:outline-none focus:border-purple-500 focus:bg-black/40 transition-all text-sm md:text-base"
                                        placeholder="e.g. 2024441674"
                                    />
                                </div>
                            </div>
                            
                            {error && (
                                <div className="p-3 rounded-lg bg-red-500/20 border border-red-500/30 text-red-200 text-xs md:text-sm text-center">
                                    <i className="fa-solid fa-circle-exclamation mr-2"></i>
                                    {error}
                                </div>
                            )}

                            <button 
                                type="submit" 
                                className="w-full py-3.5 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold rounded-xl shadow-lg shadow-purple-900/40 transition-all transform hover:scale-[1.02] text-sm md:text-base"
                            >
                                Sign In
                            </button>
                        </form>
                        
                        <div className="mt-8 text-center">
                             <p className="text-xs text-gray-500 mb-2">Registered Students Only</p>
                             <div className="text-[10px] text-gray-600 font-mono">
                                Try: 2024441674 or 2024696532
                             </div>
                        </div>
                    </div>
                </div>
            );
        };

        const Sidebar = ({ activeTab, setActiveTab, onLogout }) => {
            const menuItems = [
                { id: 'dashboard', icon: 'fa-table-columns', label: 'Dashboard' },
                { id: 'search', icon: 'fa-magnifying-glass', label: 'Search' },
                { id: 'rooms', icon: 'fa-people-roof', label: 'Room Booking' },
                { id: 'digital-id', icon: 'fa-id-card', label: 'My Digital ID' },
                { id: 'analytics', icon: 'fa-chart-line', label: 'Analytics' },
            ];

            return (
                <aside className="w-16 md:w-20 lg:w-64 h-full flex flex-col transition-all duration-300 bg-nexus-dark/80 backdrop-blur-xl border-r border-nexus-glassBorder z-20 flex-shrink-0">
                    <div className="h-20 md:h-24 flex flex-col lg:flex-row items-center justify-center lg:justify-start lg:px-6 border-b border-nexus-glassBorder gap-2">
                        <div className="flex items-center gap-2">
                            <div className="w-8 h-8 md:w-10 md:h-10 rounded-lg bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center shadow-lg shadow-purple-500/30 flex-shrink-0">
                                <i className="fa-solid fa-layer-group text-white text-lg md:text-xl"></i>
                            </div>
                        </div>
                        <span className="hidden lg:block font-bold text-lg text-white tracking-wide leading-tight">
                            PTAR <span className="text-purple-400">NEXUS</span>
                        </span>
                    </div>

                    <nav className="flex-1 py-4 md:py-6 flex flex-col gap-2 px-2 md:px-3 overflow-y-auto scrollbar-hide">
                        {menuItems.map((item) => (
                            <button
                                key={item.id}
                                onClick={() => setActiveTab(item.id)}
                                className={`flex items-center justify-center lg:justify-start p-2 md:p-3 rounded-xl transition-all duration-200 group ${
                                    activeTab === item.id
                                        ? 'bg-purple-600 text-white shadow-lg shadow-purple-600/20'
                                        : 'text-gray-400 hover:bg-white/5 hover:text-white'
                                }`}
                            >
                                <i className={`fa-solid ${item.icon} w-6 text-center text-lg ${activeTab === item.id ? 'text-white' : 'text-gray-400 group-hover:text-purple-400'}`}></i>
                                <span className="hidden lg:block ml-3 font-medium whitespace-nowrap">{item.label}</span>
                            </button>
                        ))}
                    </nav>

                    <div className="p-2 md:p-4 border-t border-nexus-glassBorder">
                        <button 
                            onClick={onLogout}
                            className="flex items-center justify-center lg:justify-start w-full p-2 md:p-3 rounded-xl text-gray-400 hover:bg-red-500/10 hover:text-red-400 transition-colors"
                        >
                            <i className="fa-solid fa-arrow-right-from-bracket w-6 text-center"></i>
                            <span className="hidden lg:block ml-3 font-medium">Logout</span>
                        </button>
                    </div>
                </aside>
            );
        };

        const Header = ({ user, isOnline, setIsOnline, notifications }) => {
            const [showNotifDropdown, setShowNotifDropdown] = useState(false);
            const fullName = user.name; 
            const unreadCount = notifications.length;

            return (
                <header className="h-16 md:h-20 px-4 md:px-6 flex items-center justify-between bg-nexus-dark/60 backdrop-blur-md sticky top-0 z-10 border-b border-nexus-glassBorder flex-shrink-0">
                    <div className="overflow-hidden mr-4">
                        <h1 className="text-base md:text-xl font-bold text-white truncate">
                            Hi, <span className="text-purple-400">{fullName}</span>
                        </h1>
                        <p className="text-[10px] md:text-sm text-gray-400 truncate hidden sm:block">{user.department}</p>
                    </div>

                    <div className="flex items-center gap-3 md:gap-6">
                        <div 
                            onClick={() => setIsOnline(!isOnline)}
                            className={`cursor-pointer px-2 py-1 md:px-4 md:py-2 rounded-full border flex items-center gap-2 transition-all duration-300 ${
                                isOnline 
                                    ? 'bg-green-500/10 border-green-500/30 text-green-400' 
                                    : 'bg-red-500/10 border-red-500/30 text-red-400'
                            }`}
                        >
                            <div className={`w-1.5 h-1.5 md:w-2 md:h-2 rounded-full ${isOnline ? 'bg-green-400 animate-pulse' : 'bg-red-400'}`}></div>
                            <span className="text-[10px] md:text-sm font-semibold hidden md:inline">{isOnline ? 'Online' : 'Offline'}</span>
                        </div>

                        <div className="flex items-center gap-3 pl-3 md:pl-6 border-l border-nexus-glassBorder relative">
                            {/* Notification Bell */}
                            <button 
                                onClick={() => setShowNotifDropdown(!showNotifDropdown)}
                                className="w-8 h-8 md:w-10 md:h-10 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-white transition-colors relative"
                            >
                                <i className="fa-solid fa-bell text-sm md:text-base"></i>
                                {unreadCount > 0 && (
                                    <span className="absolute top-0 right-0 w-4 h-4 bg-red-500 rounded-full text-[10px] flex items-center justify-center font-bold border-2 border-nexus-dark">{unreadCount}</span>
                                )}
                            </button>
                            
                            {/* Dropdown */}
                            {showNotifDropdown && (
                                <div className="absolute top-12 right-2 md:right-12 w-72 bg-slate-800 border border-white/10 rounded-xl shadow-2xl overflow-hidden z-50 animate-fade-in">
                                    <div className="px-4 py-3 border-b border-white/10 bg-slate-900/50">
                                        <h4 className="text-sm font-semibold text-white">Notifications</h4>
                                    </div>
                                    <div className="max-h-64 overflow-y-auto">
                                        {notifications.length === 0 ? (
                                            <div className="p-4 text-center text-gray-500 text-xs">No new notifications</div>
                                        ) : (
                                            notifications.map((notif, idx) => (
                                                <div key={idx} className="p-3 border-b border-white/5 hover:bg-white/5 transition-colors">
                                                    <p className="text-xs text-gray-300">{notif.message}</p>
                                                    <span className="text-[10px] text-gray-500 mt-1 block">{notif.time}</span>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>
                            )}
                            
                            <img 
                                src={user.avatarUrl} 
                                alt={user.name} 
                                className="w-8 h-8 md:w-10 md:h-10 rounded-full border-2 border-purple-500/50 object-cover"
                            />
                        </div>
                    </div>
                </header>
            );
        };

        const BookDetailModal = ({ book, onClose, onToggleBorrow, isBorrowed, onRead }) => {
            if (!book) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" onClick={onClose}></div>
                    <div className="relative bg-slate-900 border border-white/10 rounded-2xl w-full max-w-2xl max-h-[90dvh] shadow-2xl flex flex-col md:flex-row overflow-hidden animate-fade-in">
                        {/* Close Button */}
                        <button onClick={onClose} className="absolute top-3 right-3 z-10 w-8 h-8 rounded-full bg-black/50 text-white flex items-center justify-center hover:bg-white/20 transition-colors">
                            <i className="fa-solid fa-xmark"></i>
                        </button>

                        {/* Image Section */}
                        <div className="w-full md:w-1/3 h-48 md:h-auto relative flex-shrink-0 bg-white/5">
                             {book.coverImage !== 'placeholder' ? (
                                <img src={book.coverImage} alt={book.title} className="w-full h-full object-cover" />
                            ) : (
                                <div className="w-full h-full flex items-center justify-center text-gray-500">
                                    <i className="fa-solid fa-book text-4xl"></i>
                                </div>
                            )}
                            <div className="absolute inset-0 bg-gradient-to-t from-slate-900 to-transparent md:hidden"></div>
                        </div>

                        {/* Content Section */}
                        <div className="p-6 md:p-8 flex-1 flex flex-col min-h-0">
                            <div className="mb-4">
                                <div className="flex items-center gap-2 mb-2 flex-wrap">
                                     <span className="px-2 py-1 rounded text-xs font-bold bg-purple-500/20 text-purple-300 border border-purple-500/30">{book.type}</span>
                                     <span className="px-2 py-1 rounded text-xs font-bold bg-white/10 text-gray-300 border border-white/10">{book.genre || 'General'}</span>
                                </div>
                                <h2 className="text-xl md:text-2xl font-bold text-white leading-tight mb-1">{book.title}</h2>
                                <p className="text-base text-gray-400">by <span className="text-gray-200">{book.author}</span> <span className="text-gray-600 mx-1">•</span> Published: <span className="text-gray-200">{book.year}</span></p>
                            </div>

                            <div className="flex-1 overflow-y-auto mb-6 pr-2 scrollbar-hide">
                                <h3 className="text-xs font-semibold text-gray-500 mb-2 uppercase tracking-wider">Summary</h3>
                                <p className="text-gray-300 text-sm leading-relaxed">{book.summary || 'No summary available for this title.'}</p>
                            </div>

                            <div className="flex gap-3 mt-auto pt-4 border-t border-white/5">
                                 {/* Action Buttons based on type */}
                                 {book.type === ResourceType.PHYSICAL ? (
                                     <button
                                        onClick={() => onToggleBorrow(book)}
                                        className={`flex-1 py-3 px-4 rounded-xl font-bold transition-all text-sm flex items-center justify-center gap-2 ${isBorrowed ? 'bg-red-500/20 hover:bg-red-500 hover:text-white text-red-300 border border-red-500/50' : 'bg-green-500/20 hover:bg-green-500 hover:text-black text-green-300 border border-green-500/50'}`}
                                     >
                                        <i className={`fa-solid ${isBorrowed ? 'fa-rotate-left' : 'fa-book-open'}`}></i>
                                        {isBorrowed ? 'Return Book' : 'Borrow Book'}
                                     </button>
                                 ) : (
                                     <button 
                                        onClick={() => onRead(book)}
                                        className="flex-1 py-3 px-4 rounded-xl font-bold bg-cyan-500/20 hover:bg-cyan-500 hover:text-black text-cyan-300 border border-cyan-500/50 transition-all text-sm flex items-center justify-center gap-2"
                                     >
                                        <i className="fa-solid fa-book-reader"></i>
                                        Read Now
                                     </button>
                                 )}
                            </div>
                        </div>
                    </div>
                </div>
            )
        };

        const UnifiedSearch = ({ borrowedBooks, onToggleBorrow, likedBooks, onToggleLike }) => {
            const [query, setQuery] = useState('');
            const [activeGenre, setActiveGenre] = useState(Genre.ALL); 
            const [activeSource, setActiveSource] = useState('ALL'); // New State for Source Filter
            const [selectedBook, setSelectedBook] = useState(null);
            const [readingBook, setReadingBook] = useState(null); // Book currently being read
            
            // API State
            const [onlineBooks, setOnlineBooks] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [apiError, setApiError] = useState('');

            // Debounce ref
            const debounceTimeout = useRef(null);

            // Handler for Reading
            const handleReadBook = (book) => {
                if (book.availability === 'PTAR Digital') {
                    // Open Internal Reader for Local Digital Items
                    setReadingBook(book);
                    setSelectedBook(null); // Close modal if open
                } else if (book.key) {
                    // For Open Library, append /read to key to open the viewer directly
                    const readUrl = `https://openlibrary.org${book.key}/read`;
                    window.open(readUrl, '_blank');
                } else {
                    alert("Reader not available for this resource.");
                }
            };

            // Fetch Open Library Data based on Search Query or Genre Subject
            const fetchOpenLibrary = async (searchQuery, genre) => {
                setIsLoading(true);
                setApiError('');
                try {
                    let url = '';
                    
                    if (searchQuery) {
                        // User is searching for something specific
                        url = `https://openlibrary.org/search.json?q=${encodeURIComponent(searchQuery)}&limit=16`;
                    } else {
                        // User is browsing a genre category
                        let subject = 'university'; // Default "All" fallback
                        
                        switch(genre) {
                            case Genre.TECH: subject = 'computer_science'; break;
                            case Genre.BUSINESS: subject = 'business_management'; break;
                            case Genre.FICTION: subject = 'fiction'; break;
                            case Genre.SCIENCE: subject = 'science'; break;
                            case Genre.HISTORY: subject = 'history'; break;
                            default: subject = 'textbooks'; break;
                        }
                        url = `https://openlibrary.org/subjects/${subject}.json?limit=16`;
                    }

                    const response = await fetch(url);
                    const data = await response.json();

                    // Handle Subject API vs Search API result structure
                    let books = [];
                    if (data.works) { // Subject API returns 'works'
                        books = data.works;
                    } else if (data.docs) { // Search API returns 'docs'
                        books = data.docs;
                    }

                    if (books.length > 0) {
                        const formattedBooks = books.map(doc => ({
                            id: doc.key, 
                            key: doc.key, 
                            title: doc.title,
                            author: doc.authors ? doc.authors[0].name : (doc.author_name ? doc.author_name[0] : 'Unknown Author'),
                            year: doc.first_publish_year || 'N/A',
                            type: ResourceType.EBOOK, 
                            genre: genre === Genre.ALL ? Genre.ALL : genre, // Assign current genre if browsing
                            availability: 'Digital Access',
                            coverImage: doc.cover_id 
                                ? `https://covers.openlibrary.org/b/id/${doc.cover_id}-M.jpg` 
                                : (doc.cover_i ? `https://covers.openlibrary.org/b/id/${doc.cover_i}-M.jpg` : 'placeholder'),
                            summary: 'View full details on Open Library.'
                        }));
                        setOnlineBooks(formattedBooks);
                    } else {
                        setOnlineBooks([]);
                    }
                } catch (err) {
                    console.error("OpenLibrary API Error:", err);
                    setApiError("Failed to fetch digital resources. Please check connection.");
                } finally {
                    setIsLoading(false);
                }
            };

            // Fetch when Active Genre changes (and no search query is active)
            useEffect(() => {
                if (!query) {
                    fetchOpenLibrary('', activeGenre);
                }
            }, [activeGenre]);

            // Fetch when Query changes (Debounced)
            useEffect(() => {
                if (debounceTimeout.current) clearTimeout(debounceTimeout.current);
                
                if (query) {
                     debounceTimeout.current = setTimeout(() => {
                        fetchOpenLibrary(query, activeGenre);
                    }, 800);
                } else {
                    // Reset to genre browse if query cleared
                    fetchOpenLibrary('', activeGenre);
                }

                return () => clearTimeout(debounceTimeout.current);
            }, [query]);

            
            // Filter logic (Separated for Grouping)
            const physicalResults = localPhysicalInventory.filter(item => {
                const matchesGenre = activeGenre === Genre.ALL || item.genre === activeGenre;
                const matchesQuery = !query || 
                                     item.title.toLowerCase().includes(query.toLowerCase()) || 
                                     item.author.toLowerCase().includes(query.toLowerCase());
                return matchesGenre && matchesQuery;
            });

            const ptarDigitalResults = localDigitalInventory.filter(item => {
                const matchesGenre = activeGenre === Genre.ALL || item.genre === activeGenre;
                const matchesQuery = !query || 
                                     item.title.toLowerCase().includes(query.toLowerCase()) || 
                                     item.author.toLowerCase().includes(query.toLowerCase());
                return matchesGenre && matchesQuery;
            });

            const openLibraryResults = onlineBooks; // onlineBooks is already updated based on query/genre

            // Calculate total visible results based on active source filter
            let totalVisible = 0;
            if (activeSource === 'ALL' || activeSource === 'PHYSICAL') totalVisible += physicalResults.length;
            if (activeSource === 'ALL' || activeSource === 'PTAR_DIGITAL') totalVisible += ptarDigitalResults.length;
            if (activeSource === 'ALL' || activeSource === 'OPEN_LIBRARY') totalVisible += openLibraryResults.length;


            const ResultCard = ({ result, onBookClick }) => {
                const isBorrowed = borrowedBooks.has(result.id);
                const isLiked = likedBooks.has(result.id);
                const isPhysical = result.type === ResourceType.PHYSICAL;
                const isPtarDigital = result.availability === 'PTAR Digital';

                return (
                    <div 
                        className="flex flex-row bg-white/5 backdrop-blur-sm border border-white/10 rounded-xl overflow-hidden hover:bg-white/10 hover:border-purple-500/30 transition-all duration-300 group h-full cursor-pointer relative"
                        onClick={() => onBookClick(result)}
                    >
                        <div className="w-24 md:w-32 flex-shrink-0 relative bg-black/20">
                            {result.coverImage !== 'placeholder' ? (
                                <img 
                                    src={result.coverImage} 
                                    alt={result.title} 
                                    className="w-full h-full object-cover"
                                    loading="lazy"
                                />
                            ) : (
                                <div className="w-full h-full flex items-center justify-center text-gray-500 bg-white/5">
                                    <div className="text-center p-2">
                                        <i className={`fa-solid ${isPhysical ? 'fa-book' : 'fa-laptop-code'} text-2xl mb-1`}></i>
                                        <div className="text-[9px] uppercase font-bold text-gray-600">{result.type}</div>
                                    </div>
                                </div>
                            )}
                            
                            <div className="absolute top-2 left-2 flex flex-col gap-1">
                                {isPhysical ? (
                                    <span className="px-1.5 py-0.5 md:px-2 md:py-1 bg-amber-500/90 text-black text-[9px] md:text-[10px] font-bold rounded shadow-md">Physical</span>
                                ) : isPtarDigital ? (
                                    <span className="px-1.5 py-0.5 md:px-2 md:py-1 bg-purple-500/90 text-white text-[9px] md:text-[10px] font-bold rounded shadow-md">PTAR Online</span>
                                ) : (
                                    <span className="px-1.5 py-0.5 md:px-2 md:py-1 bg-cyan-500/90 text-black text-[9px] md:text-[10px] font-bold rounded shadow-md">Open Web</span>
                                )}
                            </div>
                        </div>
                        
                        <div className="p-3 md:p-4 flex flex-col justify-between flex-1 min-w-0">
                            <div>
                                <div className="text-[9px] md:text-[10px] text-purple-300 uppercase font-bold tracking-wider mb-1 truncate">{result.genre}</div>
                                <h4 className="text-white font-bold text-sm md:text-base leading-tight mb-1 line-clamp-2 group-hover:text-purple-300 transition-colors">{result.title}</h4>
                                <p className="text-gray-400 text-xs mb-2 truncate">{result.author} • {result.year}</p>
                                
                                {isPhysical ? (
                                    <div className="flex items-start gap-2 text-xs text-gray-300 bg-white/5 p-2 rounded-lg">
                                        <i className="fa-solid fa-location-dot mt-0.5 text-amber-400 flex-shrink-0"></i>
                                        <div className="overflow-hidden min-w-0">
                                            <p className="font-medium text-amber-200 truncate">{result.shelfLocation}</p>
                                            <p className="text-[10px] opacity-70 truncate">Call No: {result.callNumber}</p>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="flex items-center gap-2 text-xs text-gray-300 bg-white/5 p-2 rounded-lg">
                                        {isPtarDigital ? <i className="fa-solid fa-lock text-purple-400 flex-shrink-0"></i> : <i className="fa-solid fa-globe text-cyan-400 flex-shrink-0"></i>}
                                        <p className={`font-medium truncate ${isPtarDigital ? 'text-purple-200' : 'text-cyan-200'}`}>
                                            {isPtarDigital ? 'Authorized Student Access' : 'Public Digital Access'}
                                        </p>
                                    </div>
                                )}
                            </div>

                            <div className="mt-3 flex gap-2">
                                {isPhysical ? (
                                    <button 
                                        onClick={(e) => {
                                            e.stopPropagation(); 
                                            onToggleBorrow(result);
                                        }}
                                        className={`flex-1 py-1.5 px-2 md:px-3 border rounded-lg text-[10px] md:text-xs font-medium transition-all whitespace-nowrap ${
                                            isBorrowed 
                                                ? 'bg-red-500/20 hover:bg-red-500 hover:text-white border-red-500/50 text-red-300' 
                                                : 'bg-white/10 hover:bg-green-500 hover:text-black border-white/20 text-white'
                                        }`}
                                    >
                                        {isBorrowed ? 'Return' : 'Borrow'}
                                    </button>
                                ) : (
                                    <button 
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            handleReadBook(result);
                                        }}
                                        className={`flex-1 py-1.5 px-2 md:px-3 border rounded-lg text-[10px] md:text-xs font-medium transition-all flex items-center justify-center gap-2 whitespace-nowrap ${
                                             isPtarDigital 
                                                ? 'bg-purple-600/20 hover:bg-purple-500 hover:text-white border-purple-500/50 text-purple-300' 
                                                : 'bg-cyan-600/20 hover:bg-cyan-500 hover:text-black border-cyan-500/50 text-cyan-300'
                                        }`}
                                    >
                                            <i className="fa-solid fa-book-reader"></i> {isPtarDigital ? 'View' : 'Read'}
                                    </button>
                                )}
                                <button 
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        onToggleLike(result);
                                    }}
                                    className={`w-8 flex items-center justify-center rounded-lg transition-colors ${isLiked ? 'bg-pink-500/20 text-pink-400 border border-pink-500/30' : 'bg-white/5 hover:bg-white/20 text-white'}`}
                                >
                                    <i className={`${isLiked ? 'fa-solid' : 'fa-regular'} fa-heart`}></i>
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            const filters = Object.values(Genre);

            // Source Navigation Data
            const sourceNav = [
                { id: 'ALL', label: 'All Sources', icon: 'fa-layer-group', color: 'bg-gray-600' },
                { id: 'PHYSICAL', label: 'Physical Books', icon: 'fa-book', color: 'bg-amber-600' },
                { id: 'PTAR_DIGITAL', label: 'UiTM Digital', icon: 'fa-server', color: 'bg-purple-600' },
                { id: 'OPEN_LIBRARY', label: 'Global Online', icon: 'fa-globe', color: 'bg-cyan-600' },
            ];

            return (
                <div className="w-full max-w-6xl mx-auto relative">
                    {/* Search & Filter Section */}
                    <div className="mb-6 md:mb-8">
                        {/* Search Input */}
                        <div className="relative mb-4 md:mb-6">
                            <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                <i className={`fa-solid ${isLoading ? 'fa-spinner fa-spin' : 'fa-magnifying-glass'} text-gray-400 text-lg`}></i>
                            </div>
                            <input
                                type="text"
                                className="block w-full pl-12 pr-4 py-3 md:py-4 bg-white/5 backdrop-blur-md border border-white/10 rounded-2xl text-sm md:text-base text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:bg-white/10 transition-all shadow-xl"
                                placeholder="Search by Title, Author, or Call Number..."
                                value={query}
                                onChange={(e) => setQuery(e.target.value)}
                            />
                        </div>

                        {/* NEW: Source Navigation Buttons */}
                        <div className="flex gap-2 mb-4 overflow-x-auto pb-2 scrollbar-hide -mx-2 px-2 md:mx-0 md:px-0">
                            {sourceNav.map(source => (
                                <button
                                    key={source.id}
                                    onClick={() => setActiveSource(source.id)}
                                    className={`flex items-center px-4 py-2.5 rounded-xl text-xs md:text-sm font-bold whitespace-nowrap transition-all flex-shrink-0 border ${
                                        activeSource === source.id 
                                        ? `${source.color} text-white border-white/20 shadow-lg transform scale-105` 
                                        : 'bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white border-white/5'
                                    }`}
                                >
                                    <i className={`fa-solid ${source.icon} mr-2`}></i>
                                    {source.label}
                                </button>
                            ))}
                        </div>

                        {/* Genre Tabs */}
                        <div className="flex gap-2 overflow-x-auto pb-2 scrollbar-hide -mx-2 px-2 md:mx-0 md:px-0">
                            {filters.map(genre => (
                                <button
                                    key={genre}
                                    onClick={() => setActiveGenre(genre)}
                                    className={`px-3 py-1.5 md:px-4 md:py-2 rounded-xl text-xs md:text-sm font-medium whitespace-nowrap transition-all flex-shrink-0 ${
                                        activeGenre === genre 
                                        ? 'bg-purple-600 text-white shadow-lg shadow-purple-600/20' 
                                        : 'bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white border border-white/5'
                                    }`}
                                >
                                    {genre}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Results Display */}
                    <div>
                        <h3 className="text-white/80 font-semibold text-base mb-6 flex items-center justify-between">
                            <span className="flex items-center">
                                <i className="fa-solid fa-layer-group mr-2"></i> 
                                {query ? `Results for "${query}"` : `${activeGenre}`}
                            </span>
                            <span className="text-xs text-gray-500 font-normal">
                                {isLoading ? 'Fetching online library...' : `${totalVisible} resources found`}
                            </span>
                        </h3>

                        {apiError && (
                            <div className="p-4 mb-4 bg-red-500/10 border border-red-500/20 rounded-xl text-red-300 text-sm">
                                {apiError}
                            </div>
                        )}

                        {/* Section: UiTM Physical Collection */}
                        {physicalResults.length > 0 && (activeSource === 'ALL' || activeSource === 'PHYSICAL') && (
                            <div className="mb-8 animate-fade-in">
                                <div className="flex items-center gap-2 mb-3 px-1">
                                    <div className="w-1 h-4 bg-amber-500 rounded-full"></div>
                                    <h4 className="text-amber-400 font-bold text-sm tracking-wide uppercase">UiTM Physical Collection</h4>
                                    <div className="h-px bg-white/5 flex-1 ml-2"></div>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-3 md:gap-6">
                                    {physicalResults.map((result, idx) => (
                                        <ResultCard key={result.id || `phy_${idx}`} result={result} onBookClick={setSelectedBook} />
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Section: UiTM Digital Archive */}
                        {ptarDigitalResults.length > 0 && (activeSource === 'ALL' || activeSource === 'PTAR_DIGITAL') && (
                            <div className="mb-8 animate-fade-in">
                                <div className="flex items-center gap-2 mb-3 px-1">
                                    <div className="w-1 h-4 bg-purple-500 rounded-full"></div>
                                    <h4 className="text-purple-400 font-bold text-sm tracking-wide uppercase">UiTM Digital Archive</h4>
                                    <div className="h-px bg-white/5 flex-1 ml-2"></div>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-3 md:gap-6">
                                    {ptarDigitalResults.map((result, idx) => (
                                        <ResultCard key={result.id || `dig_${idx}`} result={result} onBookClick={setSelectedBook} />
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Section: Open Library Global */}
                        {((openLibraryResults.length > 0 || isLoading) && (activeSource === 'ALL' || activeSource === 'OPEN_LIBRARY')) && (
                            <div className="mb-8 animate-fade-in">
                                <div className="flex items-center gap-2 mb-3 px-1">
                                    <div className="w-1 h-4 bg-cyan-500 rounded-full"></div>
                                    <h4 className="text-cyan-400 font-bold text-sm tracking-wide uppercase">Global Online Resources (Open Library)</h4>
                                    <div className="h-px bg-white/5 flex-1 ml-2"></div>
                                </div>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-3 md:gap-6">
                                    {openLibraryResults.map((result, idx) => (
                                        <ResultCard key={result.id || `ol_${idx}`} result={result} onBookClick={setSelectedBook} />
                                    ))}
                                </div>
                                
                                {isLoading && (
                                     <div className="text-center py-10 text-gray-500 w-full col-span-full">
                                        <i className="fa-solid fa-spinner fa-spin text-2xl mb-2 opacity-50"></i>
                                        <p className="text-xs">Fetching more from global database...</p>
                                    </div>
                                )}
                            </div>
                        )}
                        
                        {!isLoading && totalVisible === 0 && (
                            <div className="text-center py-20 text-gray-500">
                                <i className="fa-solid fa-book-open text-4xl mb-4 opacity-50"></i>
                                <p>No resources found matching your criteria.</p>
                            </div>
                        )}
                    </div>

                    {/* Modal */}
                    <BookDetailModal 
                        book={selectedBook} 
                        onClose={() => setSelectedBook(null)} 
                        onToggleBorrow={onToggleBorrow}
                        isBorrowed={selectedBook ? borrowedBooks.has(selectedBook.id) : false}
                        onRead={handleReadBook}
                    />

                    {/* Reader Overlay for PTAR Books */}
                    {readingBook && (
                        <BookReader book={readingBook} onClose={() => setReadingBook(null)} />
                    )}
                </div>
            );
        };

        const DigitalID = ({ user }) => {
            const [scanning, setScanning] = useState(false);
            const [scanSuccess, setScanSuccess] = useState(false);

            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${user.studentId}&color=6d28d9&bgcolor=ffffff`;

            const handleScan = () => {
                if (scanning || scanSuccess) return;
                setScanning(true);
                setTimeout(() => {
                    setScanning(false);
                    setScanSuccess(true);
                    setTimeout(() => setScanSuccess(false), 3000);
                }, 2000);
            };

            return (
                <div className="bg-white/5 backdrop-blur-md border border-white/10 rounded-2xl p-4 md:p-6 flex flex-col items-center shadow-xl relative overflow-hidden group h-full">
                    <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-purple-500 to-pink-500"></div>
                    
                    <div className="w-full flex justify-between items-center mb-4">
                        <h3 className="text-white font-semibold flex items-center gap-2 text-sm md:text-base">
                            <i className="fa-solid fa-id-card text-purple-400"></i> Digital ID
                        </h3>
                        <span className={`text-[10px] md:text-xs px-2 py-1 rounded border transition-colors ${
                            scanSuccess 
                                ? 'bg-green-500/30 text-green-200 border-green-500' 
                                : 'bg-green-500/20 text-green-300 border-green-500/30'
                        }`}>
                            {scanSuccess ? 'VERIFIED' : 'Active'}
                        </span>
                    </div>

                    <div className="relative bg-white p-2 md:p-3 rounded-xl mb-4 shadow-lg shadow-purple-500/20 group-hover:scale-105 transition-transform duration-300 overflow-hidden">
                        <img src={qrUrl} alt="Student ID QR" className="w-24 h-24 md:w-32 md:h-32" />
                        
                        {scanning && (
                            <div className="absolute inset-0 bg-purple-500/20">
                                <div className="absolute w-full h-1 bg-red-500 shadow-[0_0_15px_rgba(239,68,68,0.8)] animate-scan"></div>
                            </div>
                        )}
                        
                        {scanSuccess && (
                            <div className="absolute inset-0 bg-green-500/90 flex items-center justify-center flex-col animate-fade-in">
                                <i className="fa-solid fa-circle-check text-white text-3xl md:text-4xl mb-2"></i>
                                <span className="text-white font-bold text-xs md:text-sm">Granted</span>
                            </div>
                        )}
                    </div>

                    <p className="text-gray-300 font-mono text-base md:text-lg tracking-wider mb-4">{user.studentId}</p>

                    <button 
                        onClick={handleScan}
                        disabled={scanning || scanSuccess}
                        className={`w-full py-2 md:py-3 rounded-xl font-medium shadow-lg transition-all flex items-center justify-center gap-2 text-sm md:text-base ${
                            scanSuccess 
                                ? 'bg-green-600 text-white cursor-default'
                                : scanning 
                                    ? 'bg-gray-600 text-gray-300 cursor-wait' 
                                    : 'bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white shadow-purple-900/40'
                        }`}
                    >
                        {scanning ? <><i className="fa-solid fa-spinner fa-spin"></i> Connecting...</> : 
                         scanSuccess ? <><i className="fa-solid fa-check"></i> Scanned</> : 
                         <><i className="fa-solid fa-expand"></i> Scan at Kiosk</>}
                    </button>
                </div>
            );
        };

        const RoomBooking = () => {
            return (
                <div className="bg-white/5 backdrop-blur-md border border-white/10 rounded-2xl p-4 md:p-6 shadow-xl h-full">
                    <div className="flex justify-between items-center mb-6">
                        <h3 className="text-white font-semibold flex items-center gap-2 text-sm md:text-base">
                            <i className="fa-solid fa-people-roof text-pink-400"></i> Smart Booking
                        </h3>
                        <button className="text-xs text-purple-300 hover:text-white transition-colors">View All</button>
                    </div>

                    <div className="grid grid-cols-1 gap-3 md:gap-4">
                        {roomData.map((room) => (
                            <div 
                                key={room.id} 
                                className="flex items-center justify-between p-3 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 transition-colors"
                            >
                                <div className="flex items-center gap-3 min-w-0">
                                    <div className={`w-3 h-3 rounded-full shadow-lg flex-shrink-0 ${
                                        room.status === 'Available' ? 'bg-green-500 shadow-green-500/50' : 
                                        room.status === 'Occupied' ? 'bg-red-500 shadow-red-500/50' : 'bg-gray-500'
                                    }`}></div>
                                    <div className="overflow-hidden">
                                        <h4 className="text-white text-xs md:text-sm font-medium truncate">{room.name}</h4>
                                        <p className="text-[10px] md:text-xs text-gray-400">Cap: {room.capacity}</p>
                                    </div>
                                </div>

                                {room.status === 'Available' ? (
                                    <button className="px-2 py-1 md:px-3 md:py-1.5 bg-green-500/20 text-green-300 border border-green-500/30 rounded-lg text-[10px] md:text-xs font-semibold hover:bg-green-500 hover:text-black transition-all whitespace-nowrap ml-2">
                                        Book
                                    </button>
                                ) : room.status === 'Occupied' ? (
                                    <span className="text-[10px] md:text-xs text-red-400 font-medium whitespace-nowrap ml-2">Until {room.nextAvailable}</span>
                                ) : (
                                    <span className="text-[10px] md:text-xs text-gray-500 font-medium ml-2">Closed</span>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const Analytics = () => {
            const [data, setData] = useState(initialAnalyticsData);

            useEffect(() => {
                const interval = setInterval(() => {
                    setData(prevData => prevData.map(item => ({
                        ...item,
                        value: Math.max(10, item.value + Math.floor(Math.random() * 30) - 10)
                    })));
                }, 3000);
                return () => clearInterval(interval);
            }, []);

            const maxVal = Math.max(...data.map(d => d.value));

            return (
                <div className="bg-white/5 backdrop-blur-md border border-white/10 rounded-2xl p-4 md:p-6 shadow-xl h-full flex flex-col">
                    <div className="flex justify-between items-center mb-4">
                        <h3 className="text-white font-semibold flex items-center gap-2 text-sm md:text-base">
                            <i className="fa-solid fa-chart-pie text-cyan-400"></i> Live Analytics
                        </h3>
                        <div className="flex items-center gap-2">
                            <span className="relative flex h-2 w-2">
                              <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                              <span className="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                            </span>
                            <span className="text-[10px] text-green-400 uppercase tracking-wider font-bold">Live</span>
                        </div>
                    </div>

                    <div className="flex-1 w-full flex items-end justify-between gap-2 md:gap-4 mt-4 px-1 md:px-2">
                        {data.map((item, index) => {
                            const heightPercentage = (item.value / (maxVal * 1.2)) * 100;
                            return (
                                <div key={index} className="flex flex-col items-center flex-1 group">
                                    <div className="relative w-full flex justify-center h-28 md:h-40 items-end">
                                        <div className="absolute -top-8 opacity-0 group-hover:opacity-100 transition-opacity bg-slate-800 text-white text-[10px] px-2 py-1 rounded pointer-events-none whitespace-nowrap border border-white/10 z-10">
                                            {item.value} books
                                        </div>
                                        <div 
                                            className={`w-full max-w-[20px] md:max-w-[40px] rounded-t-lg transition-all duration-700 ease-out ${item.color} opacity-80 group-hover:opacity-100`}
                                            style={{ height: `${heightPercentage}%`, minHeight: '4px' }}
                                        ></div>
                                    </div>
                                    <span className="text-[9px] md:text-xs text-gray-400 mt-2 font-medium truncate w-full text-center">{item.name}</span>
                                </div>
                            );
                        })}
                    </div>
                    
                    <p className="text-center text-[10px] text-gray-500 mt-6 pt-4 border-t border-white/5">
                        Real-time RFID Tracking
                    </p>
                </div>
            );
        };

        const App = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [isOnline, setIsOnline] = useState(true);
            const [notifications, setNotifications] = useState([]);
            const [borrowedBooks, setBorrowedBooks] = useState(new Set());
            const [likedBooks, setLikedBooks] = useState(new Set());

            const handleLogin = (userData) => {
                setUser(userData);
                setIsLoggedIn(true);
                addNotification(`Welcome back, ${userData.name.split(' ')[0]}!`);
            };

            const handleLogout = () => {
                setIsLoggedIn(false);
                setUser(null);
                setActiveTab('dashboard');
                setNotifications([]);
                setBorrowedBooks(new Set());
                setLikedBooks(new Set());
            };

            const addNotification = (message) => {
                const newNotif = {
                    message,
                    time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                    read: false
                };
                setNotifications(prev => [newNotif, ...prev]);
            };

            const toggleBorrow = (book) => {
                const newBorrowed = new Set(borrowedBooks);
                if (newBorrowed.has(book.id)) {
                    newBorrowed.delete(book.id);
                    addNotification(`You returned "${book.title}". Thank you!`);
                } else {
                    newBorrowed.add(book.id);
                    addNotification(`You borrowed "${book.title}". Please pick it up at Counter A.`);
                }
                setBorrowedBooks(newBorrowed);
            };

            const toggleLike = (book) => {
                const newLiked = new Set(likedBooks);
                if (newLiked.has(book.id)) {
                    newLiked.delete(book.id);
                } else {
                    newLiked.add(book.id);
                    addNotification(`You liked "${book.title}"`);
                }
                setLikedBooks(newLiked);
            };

            if (!isLoggedIn) {
                return <LoginScreen onLogin={handleLogin} />;
            }

            return (
                <div className="flex h-dvh bg-nexus-dark text-white font-sans overflow-hidden bg-[url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072&auto=format&fit=crop')] bg-cover bg-center">
                    <div className="absolute inset-0 bg-nexus-dark/90 z-0"></div>
                    <div className="absolute inset-0 bg-gradient-to-tr from-purple-900/30 to-blue-900/30 z-0 pointer-events-none"></div>

                    <div className="relative z-10 flex w-full h-full">
                        <Sidebar activeTab={activeTab} setActiveTab={setActiveTab} onLogout={handleLogout} />

                        <main className="flex-1 flex flex-col h-full overflow-hidden relative">
                            
                            <Header 
                                user={user} 
                                isOnline={isOnline} 
                                setIsOnline={setIsOnline} 
                                notifications={notifications}
                            />

                            <div className="flex-1 overflow-y-auto p-4 md:p-6 scrollbar-hide">
                                {!isOnline && (
                                    <div className="w-full bg-red-500/20 border border-red-500/40 text-red-100 p-3 rounded-xl mb-4 flex items-center gap-3 animate-pulse text-sm">
                                        <i className="fa-solid fa-triangle-exclamation"></i>
                                        <p><strong>Offline Mode:</strong> Transactions cached.</p>
                                    </div>
                                )}

                                {activeTab === 'dashboard' && (
                                    <div className="flex flex-col gap-6 max-w-7xl mx-auto pb-10">
                                        <div className="w-full">
                                            <div className="mb-2">
                                                <h2 className="text-xl md:text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-400">Search</h2>
                                                <p className="text-gray-400 text-xs md:text-base">Access Open Library & Physical Resources.</p>
                                            </div>
                                            <UnifiedSearch 
                                                borrowedBooks={borrowedBooks} 
                                                onToggleBorrow={toggleBorrow} 
                                                likedBooks={likedBooks}
                                                onToggleLike={toggleLike}
                                            />
                                        </div>

                                        <div className="grid grid-cols-1 md:grid-cols-12 gap-4 md:gap-6">
                                            <div className="md:col-span-5 lg:col-span-3">
                                                <DigitalID user={user} />
                                            </div>

                                            <div className="md:col-span-7 lg:col-span-5">
                                                <RoomBooking />
                                            </div>

                                            <div className="md:col-span-12 lg:col-span-4">
                                                <Analytics />
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {activeTab === 'search' && <div className="pb-10">
                                    <UnifiedSearch 
                                        borrowedBooks={borrowedBooks} 
                                        onToggleBorrow={toggleBorrow}
                                        likedBooks={likedBooks}
                                        onToggleLike={toggleLike}
                                    />
                                </div>}
                                {activeTab === 'rooms' && (
                                    <div className="max-w-4xl mx-auto h-full pb-10">
                                        <RoomBooking />
                                    </div>
                                )}
                                {activeTab === 'digital-id' && (
                                    <div className="max-w-md mx-auto mt-10 md:mt-20 h-96 pb-10">
                                        <DigitalID user={user} />
                                    </div>
                                )}
                                {activeTab === 'analytics' && (
                                    <div className="max-w-4xl mx-auto h-[400px] mt-10 pb-10">
                                        <Analytics />
                                    </div>
                                )}
                            </div>
                        </main>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>